<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
		<meta HTTP-EQUIV="Expires" CONTENT="-1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>直播</title>
		<!--<script src="__JS__/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>-->

		{include file="public/js" /}
		<link rel="shortcut icon" href="__IMG2__/favicon.ico" />
		<link rel="bookmark" href="__IMG2__/favicon.ico" type="image/x-icon" 　/>
		<link rel="stylesheet" type="text/css" href="__CSS__/common.css" />
		<link rel="stylesheet" type="text/css" href="__CSS__/page.css"/>
		<link rel="stylesheet" type="text/css" href="__CSS__/index.css" />
		<link rel="stylesheet" type="text/css" href="__CSS__/dm.css"/>
		<link rel="stylesheet" type="text/css" href="__CSS__/animate.min.css" />
		<script src="__JS__/index.js" type="text/javascript" charset="utf-8"></script>
		{include file="public/sharejs" /}

	</head>
	<body>
		<div class="main-all clearfix mg_top10">
			<div class="live-middle left mg_top10 bg_ff">
			    <dl class="clearfix padding_10 live-box1">
			    	<dt class="left mg_top20"><img class="head-home vertical-align_m" src="{$room_info.header_img}"/></dt>
			    	<dd class="left padding_lr10 clearfix live-dd">
			    		<div class="left">
			    			<p>
				    			<strong class="font_18">{$room_info.room_name}</strong>
					    		<i class="user-rz mg_top10">
									{if $room_info.official eq 1}<span class="mg_top10 color_ff">官方认证</span>{/if}
									{if $room_info.check eq 1}<span class="mg_lr10 color_ff">主播认证</span>{/if}
								    <img class="vertical-align_m " src="{if $room_info.sex eq 0}__IMG2__/icon-woman.png{else}__IMG2__/icon-man.png{/if}">
								</i>
				    		</p>
				    		<p>个性签名：{$room_info.sign}</p>
				    		<p>直播公告：{$notice.title}</p>
			    		</div>
			    		
			    	</dd>
			    </dl>
				{if $room_info.play_status eq 1}
			    <div class="live-video" style="overflow: hidden">
			    	<div id="video"></div>
			    	<!--<a href="#" id="btn"><img src="__IMG2__/check_check.png"/><span class="color_ff">弹幕</span></a>-->
			    	<div class="dm">
						<div class="d_screen">
							<div class="d_show">

							</div>
						</div>
						<div class="send" >
						</div>
					</div>

			    </div>
				{else}
				<div class="home-chat">
					<div class="msg-chat padding_10">

					</div>
				</div>
				<p class="inp_box chate bg_e padding_10">
					<input type="text" required="required" name="" {if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)}id="msg"{/if} value="" {if ($room_info['is_close'] eq 1) and ((is_Homeowner neq 1) and (is_admin neq 1))} placeholder="禁言中" readonly="readonly" {/if}>
					<input type="button" class="s_sub"  {if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)}id="send"{/if} value="发送">
				</p>
				<div class="padding_10 clearfix">
					<ul class="left icon-livebox">
						<li class="mg_r20 pic-a"><a href="javascript:;"><img src="__IMG2__/icoo_live0.png"/><p>图片</p></a></li>
						<input type="file" id="file_pic" style="display: none">
						<li class="mg_r20 redbag-a"><a href="javascript:;"><img src="__IMG2__/icoo_live00.png"/><p>发红包</p></a></li>
						<!--<li><a href="javascript:;"><img src="__IMG2__/icoo_live01.png"/><p>竞猜</p></a></li>-->
					</ul>


				</div>
				{/if}
			</div>
			<div class="live-right left bg_ff">
				{if $room_info.play_status eq 1}
				<h4 class="padding_10 bg_e">
					<!--<img class="vertical-align_m" src="__IMG2__/icon-gb.png"/>官博内容-->
				</h4>
				<div class="live-chate padding_10">
					<p class="blue">直播公告：{$notice.content}</p>
					<!--<p class="live-msg mg_top10"><span class="blue">Ann涛</span> 进入直播间</p>-->


					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> 房主发起了一次竞猜</p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> <span class="green">房主发起了一次竞猜</span></p>-->
					<!--<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">小鬼诺诺哦</span> <span class="yell">张小三发出一个红包</span></p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">战场至欧盟</span> <span class="green">太贵了点不起</span></p>-->
					<!--<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">薰衣草233</span> <span>张小三抢到一个红包，抢到一个红包，很棒棒</span></p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> 房主发起了一次竞猜</p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> <span class="green">房主发起了一次竞猜</span><img class="vertical-align_m" src="__IMG2__/msg_sun.png" alt="" /></p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> 房主发起了一次竞猜</p>-->
				    <div class="gife" style="display: none;">
				    	<p class="padding_10">
				    		<img class="bg_gife" src="__IMG2__/gife.png"/>
				    		<img  src="__IMG2__/x.png"/>
				    		<img src="__IMG2__/2.png"/><img src="__IMG2__/4.png"/></p>
				    </div>
				</div>
				<div class="chate-inbox padding_10">
					<p class="check_box">
						<label class="custom-checkbox"><input class="check-zhengshe" type="checkbox"><i  onclick="check(this)" data-id="1"></i><span>屏蔽礼物消息</span></label>
                        <label class="custom-checkbox"><input class="check-wapian" type="checkbox"><i onclick="check(this)" data-id="2"></i><span>屏蔽系统通知消息</span></label>
					</p>
					<p class="inp_box">
						<input type="text" required="required" name=""{if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)} id="msg"{/if} value="" {if ($room_info['is_close'] eq 1) and ((is_Homeowner neq 1) and (is_admin neq 1))}readonly="readonly"{/if}/>
						<input type="button" {if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)}id="send"{/if} value="发送" />
					</p>
				</div>
				{else}
				<div class="chate-rigntnav">
					<h4 class="padding_5 bg_e">
						<img class="vertical-align_m" src="__IMG2__/icon-gb.png"/>公告
					</h4>
					<div class="text-center padding_5 bor_b">
						<p><strong>{$notice.title}</strong></p>
						<p>{$notice.role_name} &nbsp;{$notice.update_time|date='m/d/Y H:i',###}</p>
					</div>
					<p class="padding_10">
						{$notice.content}
					</p>
					<div>
						<p class="padding_10">成员（{:count($manager_list)+ $user_list['num']}人）</p>
						<!--<p class="bg_ff find-box">-->
							<!--<input type="text" name="" id="" class="bg_ff" value="" placeholder="公链底层开发实践"  />-->
							<!--<img class="find-img" src="__IMG2__/icon-find.png"/>-->
						<!--</p>-->
					</div>
				</div>
				<div class="chate-down">

					<!--<div>-->
						<!--<p class="bg_e padding_10">游客（6人）</p>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
					<!--</div>-->
				</div>
				{/if}
			</div>
		</div>

	    <script src="__JS__/TcPlayer-2.2.2.js" type="text/javascript" charset="utf-8"></script>
	    <script src="__JS__/dm.js" type="text/javascript" charset="utf-8"></script>
		<script src="//cdn.ronghub.com/RongIMLib-2.3.3.min.js"></script>
	<script type="text/javascript" src="https://unpkg.com/qiniu-js@v2.4.0/dist/qiniu.min.js"></script>

	<script type="text/javascript">
		var gift_status = 1;
		var system_status = 1;
        var status = '{$room_info.play_status}';

        // function redpackge() {
            //     $('.envelope').fadeIn(200)
            //     $('.overlay').show()
            // }

	    $(function(){
	//     	$("body").css({'height':$(document).height(),'overflow':' hidden'})
	//     	var heightmain=$(".main-all").height();
	//         var heightD=$(window).height()-40;
	// //		        $(".main-all").css('height',heightD)
	//         $(".live-middle").css('height',heightD)
	//         $(".live-left").css('height',heightD)
	//         $(".live-right").css('height',heightD)
	    	
	    	
	    	function check(obj){
	    		var that=$(this)
	    		if(that.hasClass('active')){
	    				// //console.log(111)
	    			that.removeClass('active')
	    		}else{
	    				// //console.log(22)
	    			that.addClass('active')
                }
            }

        var player = new TcPlayer('video', {
			'live': true,
			"m3u8":  "{$play_info.m3u8}",
			"m3u8_hd" :"{$play_info.m3u8_hd}",
			"m3u8_sd" : "{$play_info.m3u8_sd}",
			"autoplay" : true,
			"coverpic" :  "{$play_info.img}",
			"clarityLabel" : { od: '原画', hd: '高清', sd: '标清' },
			"clarity" : 'od',
			"width" : '100%',
			"height" : '600'
			}); 
//			var status l== player.fullscreen();n(); $('.vcp-fullscreen-toggle').click(function () {  { //console.log(sta(status); });
            var html='<img src="__IMG2__/check_no.png"/>';
            $(".vcp-timelabel").html(html)
            $(document).on('click','.vcp-timelabel',function(){
            	if($(this).hasClass('active')){
            		$(this).removeClass('active');
            		$(this).children('img').attr('src','__IMG2__/check_no.png');
            	}else{
            		$(this).addClass('active');
            		$(this).children('img').attr('src','__IMG2__/check_check.png');
            	}
            	$(".dm").toggle(1000);
            })
            $(".vcp-timelabel").click()
	   })
	   </script>
	<script>
        var params = {
            appKey :"{:config('rongyun.appKey')}",
            token : "{$token}",
        };
        var callbacks = {

        };

        init(params,callbacks);
        function init(params, callbacks, modules){
            var appKey = params.appKey;
            var token = params.token;
            var navi = params.navi || "";

            modules = modules || {};
            var RongIMLib = modules.RongIMLib || window.RongIMLib;
            var RongIMClient = RongIMLib.RongIMClient;
            var protobuf = modules.protobuf || null;

            var config = {};

            //私有云切换navi导航，私有云格式 '120.92.10.214:8888'
            if(navi !== ""){
                config.navi = navi;
            }

            //私有云切换api,私有云格式 '172.20.210.38:81:8888'
            var api = params.api || "";
            if(api !== ""){
                config.api = api;
            }

            //support protobuf url + function
            if(protobuf != null){
                config.protobuf = protobuf;
            };

            RongIMLib.RongIMClient.init(appKey,null,config);
            //
            // /*
            //  文档：http://www.rongcloud.cn/docs/web.html#3、设置消息监听器
            //
            //  注意事项：
            //  1：为了看到接收效果，需要另外一个用户向本用户发消息
            //  2：判断会话唯一性 ：conversationType + targetId
            //  3：显示消息在页面前，需要判断是否属于当前会话，避免消息错乱。
            //  4：消息体属性说明可参考：http://rongcloud.cn/docs/api/js/index.html
            //  */


            var instance = RongIMClient.getInstance();

            // 连接状态监听器
            RongIMClient.setConnectionStatusListener({
                onChanged: function (status) {

                    // //console.log(status);
                    switch (status) {
                        case RongIMLib.ConnectionStatus["CONNECTED"]:
                        case 0:
                            // //console.log("连接成功")
                            callbacks.getInstance && callbacks.getInstance(instance);
                            break;

                        case RongIMLib.ConnectionStatus["CONNECTING"]:
                        case 1:
                            // //console.log("连接中")
                            break;

                        case RongIMLib.ConnectionStatus["DISCONNECTED"]:
                        case 2:
                            // //console.log("当前用户主动断开链接")
                            break;

                        case RongIMLib.ConnectionStatus["NETWORK_UNAVAILABLE"]:
                        case 3:
                            // //console.log("网络不可用")
                            break;

                        case RongIMLib.ConnectionStatus["CONNECTION_CLOSED"]:
                        case 4:
                            // //console.log("未知原因，连接关闭")
                            break;

                        case RongIMLib.ConnectionStatus["KICKED_OFFLINE_BY_OTHER_CLIENT"]:
                        case 6:
                            // //console.log("用户账户在其他设备登录，本机会被踢掉线")
                            break;

                        case RongIMLib.ConnectionStatus["DOMAIN_INCORRECT"]:
                        case 12:
                            // //console.log("当前运行域名错误，请检查安全域名配置")
                            break;
                    }
                }
            });



            //开始链接
            var userid;
            if(status == 1){
                var chatRoomId = "{$room_info.chat_id_play}"; // 聊天室 Id。
			}else{
                var chatRoomId = "{$room_info.chat_id}"; // 聊天室 Id。
			}


            RongIMClient.connect(token, {
                onSuccess: function(userId) {
                    callbacks.getCurrentUser && callbacks.getCurrentUser({userId:userId});
                    //console.log("链接成功，用户id：" + userId);
                    userid=userId;
                    var conversationtype = RongIMLib.ConversationType.CHATROOM;
                    var count =0;
                    RongIMClient.getInstance().joinChatRoom(chatRoomId, count, {
                        onSuccess: function() {
                            //console.log(chatRoomId);
                            // 加入聊天室成功。
                            //console.log('加入聊天室成功。');
                            var order = RongIMLib.GetChatRoomType.REVERSE;// 排序方式。
                            RongIMClient.getInstance().getChatRoomInfo(chatRoomId, count, order, {
                                onSuccess: function(chatRoom) {

                                    // chatRoom => 聊天室信息。
                                    // chatRoom.userInfos => 返回聊天室成员。
                                    // chatRoom.userTotalNums => 当前聊天室总人数。
                                    //console.log(chatRoom.userInfos);
                                    //console.log(chatRoom.userTotalNums);
                                },

                                onError: function(error) {
                                    // 获取聊天室信息失败。
                                }
                            });
                        },
                        onError: function(error) {
                            // 加入聊天室失败
                            //console.log('加入聊天室失败。');
                        }
                    });
                    // sendMessage('xxxx',chatRoomId);

                },
                onTokenIncorrect: function() {
                    //console.log('token无效');
                },
                onError:function(errorCode){
                    //console.log(errorCode);
                }
            });}

        // 发送消息相关参数说明
        var conversationtype = RongIMLib.ConversationType.CHATROOM;
        /*
        PRIVATE 为单聊、
        GROUP 为群组、
        CHATROOM 为聊天室、
        CUSTOMER_SERVICE 为客服、
        SYSTEM 为系统消息、
        APP_PUBLIC_SERVICE 为应用公众账号（应用内私有）、
        PUBLIC_SERVICE 为公众账号 (公有)
        */
        if(status == 1){
            var targetId = "{$room_info.chat_id_play}"; // 目标 Id，根据不同的 ConversationType，可能是用户 Id、群组 Id。
        }else{
            var targetId = "{$room_info.chat_id}"; // 目标 Id，根据不同的 ConversationType，可能是用户 Id、群组 Id。
        }



        function sendMessage(msg) {
            RongIMClient.getInstance().sendMessage(conversationtype, targetId, msg, {
                // 发送消息成功
                onSuccess: function (message) {
                    console.log('onMessage:');
                    console.log(message);
                    // var extra = message.content.extra;
                    var extra = eval('(' + message.content.extra + ')');
                    //console.log(message);
                    if(message.messageType != "PersonMessage"){

                        if(status == 1){
                            var str = '<p class="live-msg mg_top10"><span class="blue">'+extra.nick_name+':</span>'+message.content.content+' </p>';
                            $('.live-chate').append(str);
                        }else{
                            var str = '<div class="padding_10 mg_top10"><div class="clearfix text-center"><dl class="clearfix left width_100"><dt class="right"><img class="head" src="'+extra.header_img+'"></dt><dd class="right padding_lr10"><p class="text_right"><strong>'+extra.nick_name+'</strong></p><p class="mg_top5">'+message.content.content+'</p></dd></dl></div></div>';
                            $('.msg-chat').append(str)
                        }
                        var div="<div>"+message.content.content+"</div>";
                        $(".d_show").append(div);
                        init_screen();
					}else {
                        if (status == 1) {
                            var str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">'+extra.nick_name+'</span> 进入直播间<img class="vertical-align_m" src="__IMG2__/msg_hores.png" alt="" /></p>';
                            $('.live-chate').append(str);
                        }
                    }

                    // getMessage(message);
                    //message 为发送的消息对象并且包含服务器返回的消息唯一Id和发送消息时间戳
                    // //console.log("Send successfully");
                },
                onError: function (errorCode, message) {
                    var info = '';
                    switch (errorCode) {
                        case RongIMLib.ErrorCode.TIMEOUT:
                            info = '超时';
                            break;
                        case RongIMLib.ErrorCode.UNKNOWN_ERROR:
                            info = '未知错误';
                            break;
                        case RongIMLib.ErrorCode.REJECTED_BY_BLACKLIST:
                            info = '在黑名单中，无法向对方发送消息';
                            break;
                        case RongIMLib.ErrorCode.NOT_IN_DISCUSSION:
                            info = '不在讨论组中';
                            break;
                        case RongIMLib.ErrorCode.NOT_IN_GROUP:
                            info = '不在群组中';
                            break;
                        case RongIMLib.ErrorCode.NOT_IN_CHATROOM:
                            info = '不在聊天室中';
                            break;
                        default:
                            info = "x";
                            break;
                    }
                    //console.log('发送失败:' + info);
                }
            });
        }
        // function getMessage() {
        RongIMClient.setOnReceiveMessageListener({
            // 接收到的消息
            onReceived: function(message) {

                // 判断消息类型
                console.log('messageContent:');

                console.log(message);

                switch (message.messageType) {
                    case RongIMClient.MessageType.TextMessage:
                        // //console.log(message.content.content)
						// //console.log('yyyy');
                        var extra = eval('(' + message.content.extra + ')');
                        // var extra = message.content.extra;
						if(status == 1){
						    var str = '<p class="live-msg mg_top10"><span class="blue">'+extra.nick_name+':</span>'+message.content.content+' </p>';
						    $('.live-chate').append(str);
						}else{
                            var str = '<div class="padding_10 mg_top10"><div class="clearfix"><dl class="clearfix left"><dt class="left"><img class="head" src="'+extra.header_img+'"></dt><dd class="left padding_lr10"><p><strong>'+extra.nick_name+'</strong></p><p class="mg_top5">'+message.content.content+'</p></dd></dl></div></div>';
                            //发送的消息内容将会被打印
                            $('.msg-chat').append(str);
						}

                        // answers(message.content.content,message.senderUserId);
                        break;
                    case RongIMClient.MessageType.ImageMessage:
                        var extra = message.content.user;
                        // var extra = message.content.extra;
                        if(status == 1){
                            var str = '<img src="'+message.content.imageUri+'">';
                            $('.live-chate').append(str);
                        }else{
                            var str = '<div class="padding_10 mg_top10"><div class="clearfix"><dl class="clearfix left"><dt class="left"><img class="head" src="'+extra.portrait+'"></dt><dd class="left padding_lr10"><p><strong>'+extra.name+'</strong></p><p class="mg_top5"><img style="max-width: 200px" src="'+message.content.imageUri+'"></p></dd></dl></div></div>';
                            $('.msg-chat').append(str);
                        }
                        // do something...
                        break;
                    case RongIMClient.MessageType.DiscussionNotificationMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.LocationMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.RichContentMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.DiscussionNotificationMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.InformationNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.ContactNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.ProfileNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.CommandNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.CommandMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.UnknownMessage:
                        if(status == 1){
                            if(message. senderUserId== 'system'){
                                if(message.content.message.content.content.type == 'gift' ){
                                    if ((gift_status != 1)) return false;
                                    var st = '';
									for(var i=0;i<message.content.message.content.content.data.num.length;i++){
									    st += '<img src="__IMG2__/'+message.content.message.content.content.data.num[i]+'.png"/>';
									}
                                    var str = '<p class="padding_10"><img class="bg_gife" style="width: 36px;" src="'+message.content.message.content.content.data.img+'"/><img  src="__IMG2__/x.png"/>'+st+'</p>';
                                    $(".gife").html(str);
                                    $(".gife").css('display','block');
                                    $('.gife').addClass('animated slideInRight');
                                    setTimeout(function(){
                                        $('.gife').removeClass('slideInRight');

                                    }, 1000);
                                    $('.gife').delay(1000).fadeOut(200);
                                    return false;
                                }else if(message.content.message.content.content.type == 'red_package'){
                                    if ((system_status != 1)) return false;
                                    var str = '<p class="live-msg mg_top10"><i class="xi">系</i>'+message.content.message.content.content.data.role_name+'发出了一个红包 <img class="vertical-align_m" id="red" src="__IMG2__/msg_redbag.png" alt=""  onclick="getredPackage(this)" data-id="'+message.content.message.content.content.data.red_id+'" data-name="'+message.content.message.content.content.data.role_name+'" data-type="'+message.content.message.content.content.data.red_type+'" data-img="'+message.content.message.content.content.data.header_img+'"/></p>';
                                }else if(message.content.message.content.content.type == 'guess'){
                                    if ((system_status != 1)) return false;
                                    var str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="green">房主发起了一次竞猜</span><img class="vertical-align_m" src="__IMG2__/msg_tv.png" alt="" /></p>';
                                }else if(message.content.message.content.content.type == 'system'){
                                    if ((system_status != 1)) return false;
                                    var str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="green">'+message.content.message.content.content.data+'</span><img class="vertical-align_m" src="__IMG2__/msg_tv.png" alt="" /></p>';

                                }else{

                                }
                                $(".live-chate").append(str);
                            }
                        }else {
                            if (message.senderUserId == 'system') {
                                if (message.content.message.content.content.type == 'gift') {
                                    var str = '<div class="gife"><p class="padding_10"><img class="bg_gife" src="' + message.content.message.content.content.data.img + '"/><img  src="__IMG2__/x.png"/><img src="__IMG2__/2.png"/></p></div>'
                                } else if (message.content.message.content.content.type == 'red_package') {
                                    if(message.content.message.content.content.data.role_id == '{$info.role_id}'){
                                        var str = '<div class="padding_10 mg_top10"><div class="clearfix text-center"><dl class="clearfix left width_100"><dt class="right"><img class="head" src="'+message.content.message.content.content.data.header_img+'"></dt><dd class="right padding_lr10"><div class="red-bag" onclick="getredPackage(this)" data-id="'+message.content.message.content.content.data.red_id+'" data-name="'+message.content.message.content.content.data.role_name+'" data-type="'+message.content.message.content.content.data.red_type+'" data-img="'+message.content.message.content.content.data.header_img+'" style="width: 200px;height: 70px;background: url(__IMG2__/redpackage-right.png)no-repeat;background-size:100% 100% ;position: relative;"><p class="color_ff redfont" style="margin: 0px 0 0 45px;padding-top: 10px;width: 150px;text-align: left;">'+message.content.message.content.content.data.msg+'</p><p class="color_ff redfont" style="margin: 0px 0 0 45px;font-size: 0.5rem;width: 150px;text-align: left;">查看红包</p><p class="redtext" style="position: absolute;bottom: 0px;left: 5px;font-size: 12px;color: #a9a9a9;">聊天室红包</p></div></dd></dl></div></div>';
                                    }else{
                                        var str = '<div class="padding_10 mg_top10"><div class="clearfix text-center"><dl class="clearfix left width_100"><dt class="left"><img class="head" src="'+message.content.message.content.content.data.header_img+'"></dt><dd class="left padding_lr10"><div class="red-bag left_redbag"  onclick="getredPackage(this)" data-id="'+message.content.message.content.content.data.red_id+'" data-name="'+message.content.message.content.content.data.role_name+'" data-type="'+message.content.message.content.content.data.red_type+'" data-img="'+message.content.message.content.content.data.header_img+'" style="width: 200px;height: 70px;background: url(__IMG2__/redpackage-left.png)no-repeat;position: relative;background-size:100% 100% ;"><p class="color_ff redfont" style="margin: 0px 0 0 45px;padding-top: 10px;width: 150px;text-align: left;">'+message.content.message.content.content.data.msg+'</p><p class="color_ff redfont" style="margin: 0px 0 0 45px;font-size: 0.5rem;width: 150px;text-align: left;">查看红包</p><p class="redtext" style="position: absolute;bottom: 0px;left: 5px;font-size: 12px;color: #a9a9a9;">聊天室红包</p></div></dd></dl></div></div>';
									}
                                } else if (message.content.message.content.content.type == 'guess') {
                                    var str = '<p class="live-msg mg_top10"><i class="xi">系</i>' + message.content.message.content.content.data.role_name + '发出了一个红包 <img class="vertical-align_m" id="red" src="__IMG2__/msg_redbag.png" alt="" /></p>';
                                } else if (message.content.message.content.content.type == 'system') {
                                    var str = '<p><span>' + message.senderUserId + '：</span>' + message.content.content + '</p>';
                                } else {

                                }
                                $(".msg-chat").append(str);
                            }
                        }

                        //console.log('xxxxx');
                        // do something...
                        break;
                    case RongIMClient.MessageType.VoiceMessage:
                        // //console.log(message);
                        // getVoice((message.content.duration), (message.content.content));

                        break;
                    case RongIMClient.MessageType.PersonMessage:
                        // //console.log(message);
                        // getVoice((message.content.duration), (message.content.content));
                        var extra = eval('(' + message.content.extra + ')');
                        // var extra = message.content.extra;

                        var str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">'+extra.nick_name+'</span> 进入直播间<img class="vertical-align_m" src="__IMG2__/msg_hores.png" alt="" /></p>';
                        $('.live-chate').append(str);
                        break;
                    default:
                        //console.log(message);

                    // 自定义消息
                    // do something...
                }
            }
        });
        //去除标签
        function escapeJquery(srcString) {
            var escapseResult = srcString;

            var reg = new RegExp("<[^<]*>", "gi");
			escapseResult = escapseResult.replace(reg, "");
        	// console.log(escapseResult)
            return escapseResult;
        };

        $("#send").click(function () {
			window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
        $("#dm_send").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
		// $("#msg").focus(function () {
        $('#dm_msg').bind('keyup', function(event) {
            if (event.keyCode == "13") {
                //回车执行查询
                $('#dm_send').click();
            }
        });
        $('#msg').bind('keyup', function(event) {
            if (event.keyCode == "13") {
                //回车执行查询
                $('#send').click();
            }
        });
		// $("#md_msg").focus(function () {

            //   });
        $(" .redbag-box").on('click',".redbab-btn" ,function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
		function getredPackage(that) {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        }
        $("#chai").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
		$('.send_gift').click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })

        $('.report').click(function(){
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
		$("#report_submit").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
		$("#guess_begin").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
        $(".in_quiz-a").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";

        })
		$("#close").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })

        $("#guess_submit").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        });

		$(".pic-a").click(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })
		$("#file_pic").change(function () {
            window.location.href = "{:url('login/register',array('id'=>$id))}";
        })

	</script>

	</body>
</html>
