<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
		<meta HTTP-EQUIV="Expires" CONTENT="-1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>梭哈直播</title>
		<link rel="shortcut icon" href="__IMG2__/favicon.ico" />
		<link rel="bookmark" href="__IMG2__/favicon.ico" type="image/x-icon" 　/>
		<!--公用js-->
		{include file="public/js" /}
		<link rel="stylesheet" type="text/css" href="__CSS__/common.css" />
		<link rel="stylesheet" type="text/css" href="__CSS__/index.css" />
	</head>
	<body id="login">
		<div class="login-box clearfix">
			<div class="login-img left">
				<img src="__IMG2__/login_left.png"/>
			</div>
			 <!--登录注册弹窗-->
		    <div class="login-spring left">
		    	
		    	<div class="login-top font_18  text-center">
		    		手机账号登录
		    	</div>
		    	<form action="" method="post" id="form" class="login_form mg_top20">
		    		<!--登录-->
		    		<div class="login-reg active" >
			    		<p class="login-inp">
			    			<img src="__IMG2__/icon_phone.png"/>
			    			<input type="text" name="phone" id="" value="" placeholder="请输入手机号码" />
			    		</p>
			    		<!--若是手机号登录  获取手机验证码-->
			    		<p class="code-box login-inp">
							<img src="__IMG2__/icon_code.png" alt="" />
							<input type="text" name="code" id="code" class="code" value="" placeholder="请输验证码" />
							<input type="text" name="" id="msg" value="获取验证码" class="generate_code" readonly="readonly" />
						</p>
			    		
		    			<div id="slide_box">
							<div id="slide_xbox">
								<div id="btn">
									<i class="iconfont icon-double-right"></i>
									<!--<img src="__IMG2__/next.png" alt="">-->
								</div>
							</div>
							请按住滑块，拖动到最右边
						</div>
			    		
			    		<h5 class="mg_top10">登录即代表同意<a href="javasceipt:;" class="blue">soha直播平台服务协议</a></h5>
			    		<div class="login">
			    			<a class="login-a sub" >登录</a>
			    		</div>
			    		<h5 class=" clearfix">
			    			<a href="login.html" class="left">还没有账号，<span class="blue">立即注册</span></a>
			    			<a href="javasceipt:;" class="blue right">忘记密码</a>
			    		</h5>
			    	</div>
					<!--第三方登录账号-->
					{include file="public/third" /}
		    	</form>	
			</div>
		</div>
    	<script src="__JS__/index.js" type="text/javascript" charset="utf-8"></script>
    	<script src="__JS__/hd.js" type="text/javascript" charset="utf-8"></script>
    	<script type="text/javascript">
            //倒计时
            var countdown=60;
            var _generate_code = $(".generate_code");
            function settime() {
                if (countdown == 0) {
                    _generate_code.attr("disabled",false);
                    _generate_code.val("获取验证码");
                    countdown = 60;
                    return false;
                } else {
                    $(".generate_code").attr("disabled", true);
                    _generate_code.val("重新发送(" + countdown + ")");
                    countdown--;
                }
                setTimeout(function() {
                    settime();
                },1000);
            }
            $(function(){


            })
    		$("#login").css('height',$(document).height())
            var phone = '';
            var code  = '';
            var set;
            //获取验证码
            $('#msg').click(function(){

                var phone = $("input[name='phone']").val();
                if (!phone){
                    layer.msg('请输入手机号码');
                    return false;
                }else{
                    if (!verify.is_phone(phone)){
                        layer.msg('请输入正确的手机号码');
                        return false;
                    }
                }
                var formData = new FormData();
                formData.append('phone',phone);
                var btn = $(this);
                var data = httpPost('/index/sms',formData,btn,true);
                if (data !== false){
                    layer.msg('发送成功');
                    layer.closeAll("loading");
                    btn.attr('disabled', false);
                    settime();
                }
            })

            //登录
            $('.sub').click(function () {
                var phone = $("input[name='phone']").val();
                if (!phone){
                    layer.msg('请输入手机号码');
                    return false;
                }else{
                    if (!verify.is_phone(phone)){
                        layer.msg('请输入正确的手机号码');
                        return false;
                    }
                }
                var code = $("input[name='code']").val();
                if (!code){
                    layer.msg('请输入验证码');
                    return false;
                }else{
                    if (!verify.is_num(code) || code.length != 6){
                        layer.msg('验证码错误');
                        return false;
                    }
                }

                if (!locked){
                    layer.msg('请先进行滑动验证');
                    return false;
				}

                var formData = new FormData();
                formData.append('phone',phone);
                formData.append('code',code);
                var btn = $(this);
                var data = httpPost('/login/login',formData,btn,true);
                if (data !== false){
                    $.post("{:url('index/setUserInfo')}",{phone:data.phone,token:data.token},function (data) {
                        console.log(data);
                        if (data.code == 1){
                            // layer.closeAll("loading");
                            // btn.attr('disabled', false);
                            // return false;
                            //TODO 登录成功后的跳转页面更改
                            successRedirect('登录成功', "{:url('user/play')}", 1);
                        }else{
                            layer.msg('网络连接错误', {icon: 5, time: 2000});
                            layer.closeAll("loading");
                            btn.attr('disabled', false);
                        }
                    })
                }
            })
    	</script>
	</body>
</html>
