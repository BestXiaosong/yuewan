<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
		<meta HTTP-EQUIV="Expires" CONTENT="-1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>梭哈直播</title>
		<link rel="shortcut icon" href="__IMG2__/favicon.ico" />
		<link rel="bookmark" href="__IMG2__/favicon.ico" type="image/x-icon" 　/>
		<!--公用js-->
		{include file="public/js" /}

		<link rel="stylesheet" type="text/css" href="__CSS__/common.css" />
		<link rel="stylesheet" type="text/css" href="__CSS__/index.css" />
	</head>
	<body id="login">
		<div class="login-box clearfix">
			<div class="login-img left">
				<img src="__IMG2__/login_left.png" style="height: 486px;"/>
			</div>
			 <!--登录注册弹窗-->
		    <div class="login-spring left" style="height: 455px;">

				<div class="login-top clearfix">
					<!--登录类型有 ： 账户登录、手机号登录、莓过登录 -->
					<a  href="{if isset($type)}bind?type={$type}&openid={$openid}{else}login.html{/if}">{if isset($type)}帐号绑定{else}登录{/if}</a>
					<a class="active" href="javascript:;">注册</a>
				</div>
		    	<form action="" method="post" id="form" class="login_form mg_top20">
		    		<!--登录-->
		    		<div class="login-reg active" >
			    		<p class="login-inp">
			    			<img src="__IMG2__/icon_phone.png"/>
			    			<input type="text" name="phone" id="" value="" placeholder="请输入手机号码" />
			    		</p>
			    		<!--若是手机号登录  获取手机验证码-->
			    		<p class="code-box login-inp">
							<img src="__IMG2__/icon_code.png" alt="" />
							<input type="text" name="code" id="code" class="code" value="" placeholder="请输验证码" />
							<input type="text" name="" id="msg" value="获取验证码" class="generate_code" readonly="readonly" />
						</p>
						<p class="login-inp">
							<img src="__IMG2__/icon_password.png"/>
							<input type="password" id="password"  value="" placeholder="请输入密码" />
						</p>
						<p class="login-inp">
							<img src="__IMG2__/icon_password.png"/>
							<input type="password" id="trade_password"  value="" placeholder="请输入交易密码" />
						</p>

						<input type="hidden" id="type" {if isset($type)}value="{$type}"{/if}>
						<input type="hidden" id="openid" {if isset($openid)} value="{$openid}"{/if}>
						<input type="hidden" id="id" {if isset($id)} value="{$id}"{/if}>

			    		<h5 class="mg_top10">注册即代表同意<a href="javasceipt:;" class="blue">soha直播平台服务协议</a></h5>
			    		<div class="login">
			    			<a class="login-a sub" >注册</a>
			    		</div>
			    		<h5 class=" clearfix">
							{if isset($type)}
								<a href="bind?type={$type}&openid={$openid}" class="left">已有帐号，<span class="blue">立即绑定</span></a>

							{else}
								<a href="login.html" class="left">已有帐号，<span class="blue">立即登录</span></a>

							{/if}
							<a href="{:url('forget')}" class="blue right">忘记密码</a>

			    		</h5>
			    	</div>
					<!--第三方登录账号-->
					{include file="public/third" /}
		    	</form>

			</div>
		</div>
		<div class="basic_spring flow-box" style="width: 360px;">
			<h4 class="clearfix text-center bg_e padding_tb10 color_55">注册成功
				<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
			</h4>
			<div class="bg_ff live_springmain">

				<p class="mg_top20 clearfix padding_10">
					<span class="left" id="public">公钥：</span>
				</p>
				<p class="mg_top20 clearfix padding_10">
					<span class="left" id="private">私钥：<input type="text"  id="hidden_private" readonly="readonly"></span>
					<!--<input id="foo" type="text" value="hello111">-->
					<!--<button class="btn" data-clipboard-action="copy" data-clipboard-target="#foo">Copy</button> <br><br>-->
					<a class="right blue" id="copy" data-clipboard-action="copy" data-clipboard-target="#hidden_private" style="margin-top: 4%;">复制</a>
				</p>
				<p class="mg_top20 clearfix padding_10">
					<span class="left" id="download">app下载地址:{$download}</span>
				</p>
				<p class="mg_top40 text-center"><a href="javascript:;" class="btn-a " id="sure">确定</a></p>
			</div>

		</div>
		<div class="overlay"></div>
    	<script src="__JS__/index.js" type="text/javascript" charset="utf-8"></script>
    	<script src="__JS__/hd.js" type="text/javascript" charset="utf-8"></script>
		<script src="__JS__/clipboard.js" type="text/javascript" charset="utf-8"></script>

		<script >
				$(function () {
                    var clipboard = new Clipboard('#copy');

                })

            //倒计时
            var countdown=60;
            var _generate_code = $(".generate_code");
            function settime() {
                if (countdown == 0) {
                    _generate_code.attr("disabled",false);
                    _generate_code.val("获取验证码");
                    countdown = 60;
                    return false;
                } else {
                    $(".generate_code").attr("disabled", true);
                    _generate_code.val("重新发送(" + countdown + ")");
                    countdown--;
                }
                setTimeout(function() {
                    settime();
                },1000);
            }
            $(function(){


            })
    		$("#login").css('height',$(document).height())
            var phone = '';
            var code  = '';
            var set;

            //获取验证码
            $('#msg').click(function(){

                var phone = $("input[name='phone']").val();
                if (!phone){
                    layer.msg('请输入手机号码');
                    return false;
                }else{
                    if (!verify.is_phone(phone)){
                        layer.msg('请输入正确的手机号码');
                        return false;
                    }
                }
                var formData = new FormData();
                formData.append('phone',phone);
                var btn = $(this);
                var data = httpPost('/index/sms',formData,btn,true);
                if (data !== false){
                    layer.msg('发送成功');
                    layer.closeAll("loading");
                    btn.attr('disabled', false);
                    settime();
                }
            })

            //登录
            $('.sub').click(function () {
                var phone = $("input[name='phone']").val();
                if (!phone){
                    layer.msg('请输入手机号码');
                    return false;
                }else{
                    if (!verify.is_phone(phone)){
                        layer.msg('请输入正确的手机号码');
                        return false;
                    }
                }
                var code = $("input[name='code']").val();
                if (!code){
                    layer.msg('请输入验证码');
                    return false;
                }else{
                    if (!verify.is_num(code) || code.length != 6){
                        layer.msg('验证码错误');
                        return false;
                    }
                }
                var password = $("#password").val();
                var trade_password = $("#trade_password").val();
                var formData = new FormData();
                var openid = $("#openid").val()
                var type = $("#type").val()
                var user_id = $("#id").val()
				if(openid != ''){
                    formData.append('openid',openid);
				}
				if(type != ''){
                    formData.append('type',type);
				}
                if(user_id != ''){
                    formData.append('id',user_id);
                }
				formData.append('password',password)
				formData.append('trade_password',trade_password)
                formData.append('phone',phone);
                formData.append('code',code);

                var btn = $(this);
                var data = httpPost('/login/register',formData,btn,true);
                if (data !== false){
                    layer.closeAll('loading');
                    $('#public').html('公钥：'+data.public);

                    $('#hidden_private').attr('value',data.private_key);
                    $('.flow-box').fadeIn(200);
                    $('.overlay').show();
                }
            });

			$("#sure").click(function () {
                successRedirect('注册成功', "{:url('login/login')}", 1);
            })
    	</script>
	</body>
</html>
