<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
		<meta HTTP-EQUIV="Expires" CONTENT="-1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>直播</title>
		<!--<script src="__JS__/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>-->

		{include file="public/js" /}
		<link rel="shortcut icon" href="__IMG2__/favicon.ico" />
		<link rel="bookmark" href="__IMG2__/favicon.ico" type="image/x-icon" 　/>
		<link rel="stylesheet" type="text/css" href="__CSS__/common.css" />
		<link rel="stylesheet" type="text/css" href="__CSS__/page.css"/>
		<link rel="stylesheet" type="text/css" href="__CSS__/index.css" />
		<link rel="stylesheet" type="text/css" href="__CSS__/dm.css"/>
		<link rel="stylesheet" type="text/css" href="__CSS__/animate.min.css" />
		<script src="__JS__/index.js" type="text/javascript" charset="utf-8"></script>
		{include file="public/sharejs" /}

	</head>
	<body>
	{include file='public/header' /}
		<div class="main-all clearfix mg_top10">
			<div class="main-left live-left text-center padding_tb10 left">
				<div class="padding_tb20 main-lefttop">
					<p class=""><img class="uesr-head" src="{$info.header_img|default=config('default_img')}" alt="" /></p>
					<p>{$info.role_name|default="请先登录"}</p>
					<p class="user-rz mg_top10">
						{if isset($info.official)}{if $info.official eq 1}<span class="mg_top10">官方认证</span>{/if}{/if}
						{if isset($info.check)}{if $info.check eq 1}<span class="mg_lr10">主播认证</span>{/if}{/if}
					    <img class="vertical-align_m " src="{if $info.sex eq 0}__IMG2__/icon-woman.png{else}__IMG2__/icon-man.png{/if}"/>
					</p>
				</div>
				<div class="main-leftlist">
					<div class="LeftList">
						<h4 class="font_16" onclick="location.href='/play/index'"><img class="vertical-align_m mg_lr10" src="__IMG2__/icon_all.png"/>全部分类</h4>
						<ul class="mg_top10">
							{volist name="$cate" id='v'}
							<li {if isset($cid) and ($v.cid eq $cid)} class="active"{/if} onclick="location.href='{:url('play/index',array('cid'=>$v.cid))}'"><a>{$v.cate_name}</a></li>
							{/volist}
						</ul>
					</div>
					
				</div>
			</div>
			<div class="live-middle left mg_top10 bg_ff">
				{if $room_info.is_Homeowner eq 1}
			    <ul class="padding_10 bor_b clearfix live-top">
			    	<li class="flow-a"><a href="javascript:;"><img src="__IMG2__/live01.png"/><p class="mg_top5">推流码</p></a></li>
			    	<li class="quiz-a"><a href="javascript:;"><img src="__IMG2__/live02.png"/><p class="mg_top5">发起竞猜</p></a></li>
			    	<li class="redbag-a"><a href="javascript:;"><img src="__IMG2__/live03.png"/><p class="mg_top5">发红包</p></a></li>
			    	<li><a href="javascript:;"><img class="icon-switch {if $room_info.play_status eq 1}active{/if}"  src="{if $room_info.play_status eq 1}__IMG2__/check_check.png{else}__IMG2__/check_no.png{/if}" id="io"/><p class="mg_top5">直播开关</p></a></li>
			    	<!--<li><a href="javascript:;"><img class="icon-switch" src="__IMG2__/check_no.png"/><p class="mg_top5">录制开关</p></a></li>-->
			    	<li><a href="{:url('personal/mgroom')}"><img src="__IMG2__/live03.png"/><p class="mg_top5">管理直播间</p></a></li>
			    </ul>
				{/if}
			    <dl class="clearfix padding_10 live-box1">
			    	<dt class="left mg_top20"><img class="head-home vertical-align_m" src="{$room_owner_info.header_img|default=config('default_img')}"/></dt>
			    	<dd class="left padding_lr10 clearfix live-dd">
			    		<div class="left">
			    			<p>
				    			<strong class="font_18">{$room_info.room_name}</strong>
					    		<i class="user-rz mg_top10">
									{if $room_owner_info.official eq 1}<span class="mg_top10 color_ff">官方认证</span>{/if}
									{if $room_owner_info.check eq 1}<span class="mg_lr10 color_ff">主播认证</span>{/if}
								    <img class="vertical-align_m " src="{if $room_owner_info.sex eq 0}__IMG2__/icon-woman.png{else}__IMG2__/icon-man.png{/if}">
								</i>
								<a href="javascript:;" class="padding_lr10 report">举报</a>
				    		</p>
				    		<p>个性签名：{$room_owner_info.sign}</p>
				    		<p>直播公告：{$notice.title}</p>
			    		</div>
			    		<div class="right">
			    			<p class="attention-box">
			    				<a href="javascript:;" class="attention-a" id="follow" {if $room_info.is_follow eq 1}style="background:#d9d9d9;color:#7f7f7f;border:#d9d9d9 1px solid"{/if}>{if $room_info.is_follow eq 1}已关注{else}关注{/if}</a>
			    				<a href="javascript:;" class="attention-text" id="fans_num">{$room_info.fans}</a>
			    			</p>
			    			<!--<p class="share-box mg_top10">-->
			    				<!--<a href="javascript:;"><img src="__IMG2__/share_1.png"/></a>-->
			    				<!--<a href="javascript:;"><img src="__IMG2__/share_2.png"/></a>-->
			    				<!--<a href="javascript:;"><img src="__IMG2__/share_3.png"/></a>-->
			    				<!--<a href="javascript:;"><img src="__IMG2__/share_4.png"/></a>-->
			    			<!--</p>-->
							{include file="public/share" /}

						</div>
			    		
			    	</dd>
			    </dl>
				{if $room_info.play_status eq 1}
			    <div class="live-video" style="overflow: hidden">
			    	<div id="video"></div>
			    	<!--<a href="#" id="btn"><img src="__IMG2__/check_check.png"/><span class="color_ff">弹幕</span></a>-->
			    	<div class="dm">
						<div class="d_screen">
							<div class="d_show">

							</div>
						</div>
						<div class="send" >
							<div class="s_fiter">
								<div class="s_con">
									<input type="text"  maxlength="40" class="s_txt" {if ($room_info['is_close'] neq 1) or ($room_info['is_Homeowner'] eq 1) or ($room_info['is_admin'] eq 1)}id="dm_msg"{/if} {if ($room_info['is_close'] eq 1) and ($room_info['is_Homeowner'] neq 1) and ($room_info['is_admin'] neq 1)}readonly="readonly" placeholder="禁言中"{/if}/>
									<input type="button" value="发布评论" class="s_sub send_btn1"  {if ($room_info['is_close'] neq 1) or ($room_info['is_Homeowner'] eq 1) or ($room_info['is_admin'] eq 1)}id="dm_send"{/if}/>
								</div>
							</div>
						</div>
					</div>
					<div class="pk-box" style="transform: translateY(214px);opacity: 0;">
						<div class="padding_10 clearfix">
							<span class="left color_ff" id="now_code">当前积分：{$money.money}</span>
							<span class="right ">
                    			<!--<a href="javascript:;" class="color_ff">我的竞猜 丨</a>-->
                    			<!--<a href="javascript:;" class="color_ff">玩法 丨</a>-->
                    			<a href="javascript:;" class="color_ff" id="close">关闭</a>
                    		</span>
						</div>
						<div class="pk-box1">

						</div>
					</div>

			    </div>
			    <div class="padding_10 clearfix">
			    	<ul class="left icon-livebox">
			    		<li class="mg_r20  redbag-a"><a href="javascript:;"><img src="__IMG2__/icoo_live00.png"/><p>发红包</p></a></li>
			    		<li class="in_quiz-a" data-status="0"><a href="javascript:;"><img src="__IMG2__/icoo_live01.png"/><p>竞猜</p></a></li>
			    	</ul>
			    	<div class="right">
			    		<div class=" icon-livebox">
							{volist name='gift' id='v'}
			    			<a class="margin-l-r-10 block-in">
					            <img src="{$v.img}" width="100%"/>
					            <div class="popover fade top in">
					            	<div class="arrow" ></div>
					            	
					            	<div class="popover-content">
					            		<div class="clearfix">
					            			<div class="left"><img src="{$v.img}"/></div>
					            			<div class="left icon-livefadion">
												<input type="hidden" value="1">
					            				<p class="">{$v.gift_name}</p>
					            				<p class="mg_top5">需消耗：{$v.price}</p>
					            				<p class="text_right"><span class="basic_a btn_rudis bor_blue send_gift" data-id="{$v.gift_id}" >赠送</span></p>
					            			</div>
					            		</div>
					            	</div>
					            </div>
					        </a>
							{/volist}

				    		<!--<li><a href="javascript:;"><img src="__IMG2__/icoo_live02.png"/></a></li>
				    		<li><a href="javascript:;"><img src="__IMG2__/icoo_live02.png"/></a></li>
				    		<li><a href="javascript:;"><img src="__IMG2__/icoo_live02.png"/></a></li>
				    		<li><a href="javascript:;"><img src="__IMG2__/icoo_live02.png"/></a></li>
				    		<li><a href="javascript:;"><img src="__IMG2__/icoo_live02.png"/></a></li>
				    		<li><a href="javascript:;"><img src="__IMG2__/icoo_live02.png"/></a></li>-->
				    	</div>
				    	<p id="code">当前积分：{$money.money|default=0}  </p>
						<!--<a href="javascript:;" class="basic_a bor_blue btn_rudis mg_lr10">充值</a>-->
			    	</div>
			    	
			    </div>
				{else}
				<div class="home-chat">
					<div {if $room_info.play_status neq 2}style=" display:none;position:relative"{else}style="position:relative;overflow:hidden"{/if}  class="padding_10">
					<img src="{$activity.detail_img}" alt="" style="    max-height: 300px; width: 100%;">
					<div class="time-box clearfix">
						<p class="left blue mg_lr10 ">距离活动还剩:</p >
						<div class="colockbox  left" id="demo02">
							<span class="hour"></span> :
							<span class="minute"></span> :
							<span class="second"></span>
						</div>
					</div>
					</div>
					<div class="msg-chat padding_10">

					</div>
				</div>
				<p class="inp_box chate bg_e padding_10">
					<input type="text" maxlength="40" required="required" name="" class="chat_msg" {if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)}id="msg"{/if} value="" {if ($room_info['is_close'] eq 1) and ((is_Homeowner neq 1) and (is_admin neq 1))} placeholder="禁言中" readonly="readonly" {/if}>
					<input type="button" class="s_sub send_btn"   {if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)}id="send"{/if} value="发送">
				</p>
				<div class="padding_10 clearfix">
					<ul class="left icon-livebox">
						<li class="mg_r20 pic-a"><a href="javascript:;"><img src="__IMG2__/icoo_live0.png"/><p>图片</p></a></li>
						<input type="file" id="file_pic" style="display: none">
						<li class="mg_r20 redbag-a"><a href="javascript:;"><img src="__IMG2__/icoo_live00.png"/><p>发红包</p></a></li>
						<!--<li><a href="javascript:;"><img src="__IMG2__/icoo_live01.png"/><p>竞猜</p></a></li>-->
					</ul>


				</div>
				{/if}
			</div>
			<div class="live-right left bg_ff">
				{if $room_info.play_status eq 1}
			    <div class="padding_tb20 advertising live-box2">
					{volist name='ad' id='v'}
			    	<a href="{$v.url}" class="advertising-box ">
			    		<img class="width_100" src="{$v.img}">
				    	<i class="mark">广告</i>
			    	</a>
					{/volist}
				</div>
				<h4 class="padding_10 bg_e">
					<!--<img class="vertical-align_m" src="__IMG2__/icon-gb.png"/>官博内容-->
				</h4>
				<div class="live-chate padding_10">
					<p class="blue">直播公告：{$notice.content}</p>
					<!--<p class="live-msg mg_top10"><span class="blue">Ann涛</span> 进入直播间</p>-->


					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> 房主发起了一次竞猜</p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> <span class="green">房主发起了一次竞猜</span></p>-->
					<!--<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">小鬼诺诺哦</span> <span class="yell">张小三发出一个红包</span></p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">战场至欧盟</span> <span class="green">太贵了点不起</span></p>-->
					<!--<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">薰衣草233</span> <span>张小三抢到一个红包，抢到一个红包，很棒棒</span></p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> 房主发起了一次竞猜</p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> <span class="green">房主发起了一次竞猜</span><img class="vertical-align_m" src="__IMG2__/msg_sun.png" alt="" /></p>-->
					<!--<p class="live-msg mg_top10"><span class="blue">系统</span> 房主发起了一次竞猜</p>-->
				    <div class="gife" style="display: none;">
				    	<p class="padding_10">
				    		<img class="bg_gife" src="__IMG2__/gife.png"/>
				    		<img  src="__IMG2__/x.png"/>
				    		<img src="__IMG2__/2.png"/><img src="__IMG2__/4.png"/></p>
				    </div>
				</div>
				<div class="chate-inbox padding_10">
					<p class="check_box">
						<label class="custom-checkbox"><input class="check-zhengshe" type="checkbox"><i  onclick="check(this)" data-id="1"></i><span>屏蔽礼物消息</span></label>
                        <label class="custom-checkbox"><input class="check-wapian" type="checkbox"><i onclick="check(this)" data-id="2"></i><span>屏蔽系统通知消息</span></label>
					</p>
					<p class="inp_box">
						<input type="text" required="required" maxlength="40" class="play_msg" name="" {if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)} id="msg"{/if} value="" {if ($room_info['is_close'] eq 1) and ((is_Homeowner neq 1) and (is_admin neq 1))} placeholder="禁言中" readonly="readonly" {/if}/>
						<input type="button" class="send_btn" {if ($room_info['is_close'] neq 1) or (is_Homeowner eq 1) or (is_admin eq 1)}id="send"{/if} value="发送" />
					</p>
				</div>
				{else}
				<div class="chate-rigntnav">
					<h4 class="padding_5 bg_e">
						<img class="vertical-align_m" src="__IMG2__/icon-gb.png"/>公告
					</h4>
					<div class="text-center padding_5 bor_b">
						<p><strong>{$notice.title}</strong></p>
						<p>{$notice.role_name} &nbsp;{$notice.update_time|date='m/d/Y H:i',###}</p>
					</div>
					<p class="padding_10">
						{$notice.content}
					</p>
					<div>
						<p class="padding_10">成员（{:count($manager_list)+ $user_list['num']}人）</p>
						<!--<p class="bg_ff find-box">-->
							<!--<input type="text" name="" id="" class="bg_ff" value="" placeholder="公链底层开发实践"  />-->
							<!--<img class="find-img" src="__IMG2__/icon-find.png"/>-->
						<!--</p>-->
					</div>
				</div>
				<div class="chate-down">
					<div>
						<p class="bg_ff padding_10 ">房主、管理员（{$manager_list|count=###}人）</p>
						{volist name='manager_list' id='v'}
						<dl class="clearfix padding_10 bor_b">
							<dt class="left"><img class="head" src="{$v.header_img|default=config('default_img')}"/></dt>
							<dd class="left">
								<p><strong>{$v.role_name}</strong></p>
								<p class="basic_a bg_blue color_ff">{$v.remark}</p>
							</dd>
						</dl>
						{/volist}
					</div>
					{if !empty($user_list.num)}
					<div>
						<p class="bg_e padding_10">成员（{$user_list.num}人）</p>
						{volist name='user_list.data' id='v'}
						<dl class="clearfix padding_10 bor_b">
							<dt class="left"><img class="head" src="{$v.header_img|default=config('default_img')}"/></dt>
							<dd class="left">
								<p><strong>{$v.role_name}</strong></p>
								<p class="basic_a bg_blue1 color_ff ">{$v.remark}</p>
							</dd>
						</dl>
						{/volist}
					</div>
					{/if}
					<!--<div>-->
						<!--<p class="bg_e padding_10">游客（6人）</p>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
						<!--<dl class="clearfix padding_10 bor_b">-->
							<!--<dt class="left"><img class="head" src="__IMG2__/icon-head.png"/></dt>-->
							<!--<dd class="left">-->
								<!--<p><strong>区块链和比特币</strong></p>-->
								<!--<p class="basic_a bg_blue1 color_ff ">房主</p>-->
							<!--</dd>-->
						<!--</dl>-->
					<!--</div>-->
				</div>
				{/if}
			</div>
		</div>
		<!--举报-->
		<div class="live_spring report_box">
			<h4 class="clearfix text-center bg_e padding_tb10 color_55">举报 
				<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
			</h4>
			<form action="" id="report">
			<div class="bg_ff live_springmain padding_lr30">
				<p class="mg_top10">
					<label for="">请选择举报理由：</label>
					<select name="reason">
						<!--<option value="">请选择币种</option>-->
						{volist name='report_reason' id='v'}
						<option value="{$v}">{$v}</option>
						{/volist}
					</select>
				</p>
				<p class="mg_top20">
					<label for="">请详细描述：</label>
					<input type="text" name="detail" id="" value="">
				</p>
				<p class="mg_top20">
					<span>请选择图片/视频：</span>
					<input type="file" name="report_img[]" id="file" hidden="hidden" value="" multiple>
					<label for="file" class="file text-center">选择文件</label>  最多选三张
				</p>
				<p class="mg_top40 text-center"><a href="javascript:;" class="btn-a " id="report_submit">提交</a></p>
			</div>
			</form>
		</div>
		<!--发起竞猜-->
		<div class="live_spring quiz-box">
			<h4 class="clearfix text-center bg_e padding_tb10 color_55">发起竞猜 
				<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
			</h4>
			<form action="" id="guess">
			<div class="bg_ff live_springmain padding_lr30">
				<p class="mg_top10">
					<label for="">请输入题目：</label>
					<input type="text" name="title" id="" value="">
				</p>
				<p class="mg_top20">
					<label for="">请输入答案1：</label>
					<input type="text" name="answer_A" id="" value="">
				</p>
				<p class="mg_top20">
					<label for="">请输入答案2：</label>
					<input type="text" name="answer_B" id="" value="">
				</p>
				<!--<p class="mg_top20">-->
					<!--<label for="">请设置开盘时间：</label>-->
					<!--<input type="date" name="" id="" value="">-->
				<!--</p>-->
				<!--<p class="mg_top20">-->
					<!--<label for="">请设置封盘时间：</label>-->
					<!--<input type="date" name="" id="" value="">-->
				<!--</p>-->
				<!--<p class="mg_top20">-->
					<!--<label for="">请设置开奖时间：</label>-->
					<!--<input type="date" name="" id="" value="">-->
				<!--</p>-->
				<input type="reset" style="display: none" id="guess_reset">
				<p class="mg_top40 text-center"><a href="javascript:;" class="btn-a " id="guess_begin">发起</a></p>
			</div>
			</form>
		</div>
		<!--今晚能不能吃鸡-->
		<div class="live_spring chicken-box">
			<h4 class="clearfix text-center bg_e padding_tb10 color_55" id="title"><span>今晚能不能吃鸡</span>
				<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
			</h4>

			<div class="bg_ff live_springmain padding_lr30">
				<p class="mg_top10">
					<label for="">猜胜方：</label>
					<a href="javascript:;" class="basic_a " id="answer_a">能</a>
					<a href="javascript:;" class="basic_a  mg_lr10" id="answer_b">不能</a>
				</p>
				<!--<p class="mg_top20">-->
					<!--<label for="">当前赔率：</label>-->
					<!--<a href="javascript:;" class="basic_a bor">0.8</a>-->
					<!--<a href="javascript:;" class="basic_a bor mg_lr10">0.9</a>-->
				<!--</p>-->
				<p class="mg_top20">
					<label for="">底金：</label>
					<input type="text" name="money" id="money" value="">
				</p>
				<input type="hidden" id="right">
				<input type="hidden" id="answer_type">
				<input type="hidden" id="answer_id">
				<!--<p class="mg_top20">-->
					<!--<label for="">预计可获：</label>-->
					<!--<i>1000</i>-->
				<!--</p>-->
				<p class="mg_top40 text-center"><a href="javascript:;" class="btn-a " id="guess_submit">开猜</a></p>
			</div>
		</div>
		<!--发红包-->
		<div class="live_spring redbag-box">
			<h4 class="clearfix text-center bg_e padding_tb10 color_55">发红包 
				<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
			</h4>
			<form action="" id="redpackge">
			<div class="bg_ff live_springmain padding_lr30">
				<p class="mg_top10">
					<label for="">请选择币种：</label>
					<select name="money_type">
						<!--<option value="">请选择币种</option>-->
						<option value="1">积分</option>
						<option value="4">BCDN</option>
					</select>
				</p>
				<p class="mg_top10">
					<label for="">请选择红包种类：</label>
					<select name="red_type">
						<!--<option value="">请选择种类</option>-->
						<option value="2">拼手气红包</option>
						<option value="1">普通红包</option>
					</select>
				</p>
				<p class="mg_top20">
					<label for="">请输入总金额:</label>
					<input type="number" name="money"  value="">
				</p>
				<p class="mg_top20">
					<label for="">请输入个数：</label>
					<input type="number" name="num" value="">
				</p>
				<p class="mg_top20">
					<label for="">请输入文字：</label>
					<textarea name="msg" rows="5" cols="30"></textarea>
				</p>
				
				<p class="mg_top40 text-center" id="red"><a href="javascript:;" class="btn-a redbab-btn">提交</a></p>
			</div>
				<input type="reset" style="display:none;"  id="red_reset"/>
			</form>
		</div>
		<!--红包详情-->
		<div class="basic_spring redpackage_detail">
			<h4 class="clearfix text-center bg_e padding_tb10 color_55">红包详情 
				<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
			</h4>
			<div class="bg_ff live_springmain" id="red_detail">

			</div>
		</div>
		<!--直播信息-->
		<div class="basic_spring flow-box">
			<h4 class="clearfix text-center bg_e padding_tb10 color_55">直播信息 
				<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
			</h4>
			<div class="bg_ff live_springmain">
				<p class="mg_top20 clearfix padding_10">
					<span class="left">推流码：{$push_url}</span>
					<a class="right blue">复制</a>
				</p>
				<p class="padding_10 "><a class=" blue">直播教程</a></p>
				<p class="mg_top40 text-center"><a href="javascript:;" class="btn-a ">关闭</a></p>
		    </div>
		</div>
		<!--拆红包-->
		<div class="basic_spring envelope">
			<div class="envelope_main text-center">
				<p class="mg_top50"><img class="head-home" src="__IMG2__/icon-head.png" id="header_img"/></p>
				<p class="color_ff mg_top10" id="name">团子</p>
				<p class="color_ff mg_top10">给你发一个红包</p>
				<img class="font" src="__IMG2__/c.png" id="chai"/>
				<input type="hidden" value="" id="red_id">
				<input type="hidden" value="" id="red_type">
			</div>
		</div>

    <!-- 微信分享扫码-->
	<div id="wx_code" class="basic_spring key">
		<h4 class="clearfix text-center bg_e padding_tb10 color_55">
			<a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"/></a>
		</h4>

		<div class="text-center bg_ff">
			<p class="mg_top20"><strong>微信扫码分享</strong></p>

			<p id="qrcode"><img class="drcode" id="drcode" src=""/></p>

			<!--<p><a href="javascript:;" class="btn-a ">确定</a></p>-->
		</div>
	</div>
		<div class="overlay"></div>


	    <script src="__JS__/TcPlayer-2.2.2.js" type="text/javascript" charset="utf-8"></script>
	    <script src="__JS__/dm.js" type="text/javascript" charset="utf-8"></script>
	<script src="__JS__/time.js" type="text/javascript" charset="utf-8"></script>
	<script src="//cdn.ronghub.com/RongIMLib-2.3.3.min.js"></script>
	<script type="text/javascript" src="https://unpkg.com/qiniu-js@v2.4.0/dist/qiniu.min.js"></script>

	<script type="text/javascript">
		var urls = '{:url("login/login")}';
		var gift_status = 1;
		var system_status = 1;
		var no_login_status = '{$no_login}';
            // function redpackge() {
            //     $('.envelope').fadeIn(200)
            //     $('.overlay').show()
            // }

	    $(function(){
	        var st = "{$room_info.play_status}";
	        var time = "{$room_info.start_time|date='Y-m-d H:i:s',###}";
            if(st == "2") {
                countDown(time, null, "#demo02 .hour", "#demo02 .minute", "#demo02 .second");
            }
	//     	$("body").css({'height':$(document).height(),'overflow':' hidden'})
	//     	var heightmain=$(".main-all").height();
	//         var heightD=$(window).height()-40;
	// //		        $(".main-all").css('height',heightD)
	//         $(".live-middle").css('height',heightD)
	//         $(".live-left").css('height',heightD)
	//         $(".live-right").css('height',heightD)
	    	
	    	
	    	function check(obj){
	    		var that=$(this)
	    		if(that.hasClass('active')){
	    				// //console.log(111)
	    			that.removeClass('active')
	    		}else{
	    				// //console.log(22)
	    			that.addClass('active')
                }
            }

        var player = new TcPlayer('video', {
			'live': true,
			"m3u8":  "{$room_info.playUrl.m3u8}",
			"m3u8_hd" :"{$room_info.playUrl.m3u8_hd}",
			"m3u8_sd" : "{$room_info.playUrl.m3u8_sd}",
			"autoplay" : true,
			"coverpic" :  "{$room_info.playUrl.img}",
			"clarityLabel" : { od: '原画', hd: '高清', sd: '标清' },
			"clarity" : 'od',
			"width" : '100%',
			"height" : '600'
			}); 
//			var status l== player.fullscreen();n(); $('.vcp-fullscreen-toggle').click(function () {  { //console.log(sta(status); });
            var html='<img src="__IMG2__/check_no.png"/>';
            $(".vcp-timelabel").html(html)
            $(document).on('click','.vcp-timelabel',function(){
            	if($(this).hasClass('active')){
            		$(this).removeClass('active');
            		$(this).children('img').attr('src','__IMG2__/check_no.png');
            	}else{
            		$(this).addClass('active');
            		$(this).children('img').attr('src','__IMG2__/check_check.png');
            	}
            	$(".dm").toggle(1000);
            })
            $(".vcp-timelabel").click()
	   })
	   </script>
	<script>
		var status = '{$room_info.play_status}';
		var is_owner = '{$room_info.is_Homeowner}';
		var is_admin = '{$room_info.is_admin}';
        var params = {
            appKey :"{:config('rongyun.appKey')}",
            token : "{$room_info.r_token}",
        };

        var callbacks = {

        };

        init(params,callbacks);
        function init(params, callbacks, modules){
            var appKey = params.appKey;
            var token = params.token;
            var navi = params.navi || "";

            modules = modules || {};
            var RongIMLib = modules.RongIMLib || window.RongIMLib;
            var RongIMClient = RongIMLib.RongIMClient;
            var protobuf = modules.protobuf || null;

            var config = {};

            //私有云切换navi导航，私有云格式 '120.92.10.214:8888'
            if(navi !== ""){
                config.navi = navi;
            }

            //私有云切换api,私有云格式 '172.20.210.38:81:8888'
            var api = params.api || "";
            if(api !== ""){
                config.api = api;
            }

            //support protobuf url + function
            if(protobuf != null){
                config.protobuf = protobuf;
            };


            RongIMLib.RongIMClient.init(appKey,null,config);
            var messageName = "PersonMessage"; // 消息名称。
            var objectName = "RC:Welcome"; // 消息内置名称，请按照此格式命名。
            var mesasgeTag = new RongIMLib.MessageTag(true,true);// 消息是否保存是否计数，true true 保存且计数，false false 不保存不计数。
            var prototypes = ["content","extra"]; // 消息类中的属性名。
            RongIMClient.registerMessageType(messageName,objectName,mesasgeTag,prototypes);
            //
            // /*
            //  文档：http://www.rongcloud.cn/docs/web.html#3、设置消息监听器
            //
            //  注意事项：
            //  1：为了看到接收效果，需要另外一个用户向本用户发消息
            //  2：判断会话唯一性 ：conversationType + targetId
            //  3：显示消息在页面前，需要判断是否属于当前会话，避免消息错乱。
            //  4：消息体属性说明可参考：http://rongcloud.cn/docs/api/js/index.html
            //  */


            var instance = RongIMClient.getInstance();

            // 连接状态监听器
            RongIMClient.setConnectionStatusListener({
                onChanged: function (status) {

                    // //console.log(status);
                    switch (status) {
                        case RongIMLib.ConnectionStatus["CONNECTED"]:
                        case 0:
                            // //console.log("连接成功")
                            callbacks.getInstance && callbacks.getInstance(instance);
                            break;

                        case RongIMLib.ConnectionStatus["CONNECTING"]:
                        case 1:
                            // //console.log("连接中")
                            break;

                        case RongIMLib.ConnectionStatus["DISCONNECTED"]:
                        case 2:
                            // //console.log("当前用户主动断开链接")
                            break;

                        case RongIMLib.ConnectionStatus["NETWORK_UNAVAILABLE"]:
                        case 3:
                            // //console.log("网络不可用")
                            break;

                        case RongIMLib.ConnectionStatus["CONNECTION_CLOSED"]:
                        case 4:
                            // //console.log("未知原因，连接关闭")
                            break;

                        case RongIMLib.ConnectionStatus["KICKED_OFFLINE_BY_OTHER_CLIENT"]:
                        case 6:
                            // //console.log("用户账户在其他设备登录，本机会被踢掉线")
                            break;

                        case RongIMLib.ConnectionStatus["DOMAIN_INCORRECT"]:
                        case 12:
                            // //console.log("当前运行域名错误，请检查安全域名配置")
                            break;
                    }
                }
            });



            //开始链接
            var userid;
            if(status == 1){
                var chatRoomId = "{$room_info.chat_id_play}"; // 聊天室 Id。
			}else{
                var chatRoomId = "{$room_info.chat_id}"; // 聊天室 Id。
			}


            RongIMClient.connect(token, {
                onSuccess: function(userId) {
                    callbacks.getCurrentUser && callbacks.getCurrentUser({userId:userId});
                    //console.log("链接成功，用户id：" + userId);
                    userid=userId;
                    var conversationtype = RongIMLib.ConversationType.CHATROOM;
                    var count =0;
                    RongIMClient.getInstance().joinChatRoom(chatRoomId, count, {
                        onSuccess: function() {
                            console.log(chatRoomId);
                            // 加入聊天室成功。
                            console.log('加入聊天室成功。');
                            var extra = new Object();
                            extra.role_id = "{$room_info.role_id}";
                            extra.nick_name = "{$info.role_name|default='请先登录'}";
                            extra.header_img = "{$info.header_img|default=config('default_header')}";
                            var msg = new RongIMClient.RegisterMessage.PersonMessage({
                                content:'',
                                extra:JSON.stringify(extra),
                            });
                            if(extra.nick_name != '请先登录'){
                                sendMessage(msg);
                            }
                            var order = RongIMLib.GetChatRoomType.REVERSE;// 排序方式。
                            RongIMClient.getInstance().getChatRoomInfo(chatRoomId, count, order, {
                                onSuccess: function(chatRoom) {

                                    // chatRoom => 聊天室信息。
                                    // chatRoom.userInfos => 返回聊天室成员。
                                    // chatRoom.userTotalNums => 当前聊天室总人数。
                                    //console.log(chatRoom.userInfos);
                                    //console.log(chatRoom.userTotalNums);
                                },

                                onError: function(error) {
                                    // 获取聊天室信息失败。
                                }
                            });
                        },
                        onError: function(error) {
                            // 加入聊天室失败
                            console.log(error);
                        }
                    });
                    // sendMessage('xxxx',chatRoomId);

                },
                onTokenIncorrect: function() {
                    //console.log('token无效');
                },
                onError:function(errorCode){
                    //console.log(errorCode);
                }
            });}

        // 发送消息相关参数说明
        var conversationtype = RongIMLib.ConversationType.CHATROOM;
        /*
        PRIVATE 为单聊、
        GROUP 为群组、
        CHATROOM 为聊天室、
        CUSTOMER_SERVICE 为客服、
        SYSTEM 为系统消息、
        APP_PUBLIC_SERVICE 为应用公众账号（应用内私有）、
        PUBLIC_SERVICE 为公众账号 (公有)
        */
        if(status == 1){
            var targetId = "{$room_info.chat_id_play}"; // 目标 Id，根据不同的 ConversationType，可能是用户 Id、群组 Id。
        }else{
            var targetId = "{$room_info.chat_id}"; // 目标 Id，根据不同的 ConversationType，可能是用户 Id、群组 Id。
        }



        function sendMessage(msg) {
            RongIMClient.getInstance().sendMessage(conversationtype, targetId, msg, {
                // 发送消息成功
                onSuccess: function (message) {
                    console.log('onMessage:');
                    console.log(message);
                    // var extra = message.content.extra;
                    var extra = eval('(' + message.content.extra + ')');
                    //console.log(message);
                    if(message.messageType != "PersonMessage"&& message.messageType != "ImageMessage"){

                        if(status == 1){
                            var str = '<p class="live-msg mg_top10"><span class="blue">'+extra.nick_name+':</span>'+message.content.content+' </p>';
                            $('.live-chate').append(str);
                            $(".live-chate").scrollTop($(".live-chate")[0].scrollHeight);
                        }else{
                            var str = '<div class="padding_10 mg_top10"><div class="clearfix text-center"><dl class="clearfix left width_100"><dt class="right"><img class="head" src="'+extra.header_img+'"></dt><dd class="right padding_lr10"><p class="text_right"><strong>'+extra.nick_name+'</strong></p><p class="mg_top5">'+message.content.content+'</p></dd></dl></div></div>';
                            $('.msg-chat').append(str);
                            $(".msg-chat").scrollTop($(".msg-chat")[0].scrollHeight);
                        }
                        var div="<div>"+message.content.content+"</div>";
                        $(".d_show").append(div);
                        init_screen();
					}else{
                        if (status == 1) {
                            var str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">'+extra.nick_name+'</span> 进入直播间<img class="vertical-align_m" src="__IMG2__/msg_hores.png" alt="" /></p>';
                            $('.live-chate').append(str);
                            $(".live-chate").scrollTop($(".live-chate")[0].scrollHeight);
                        }
                    }
                    if(message.messageType == "ImageMessage"){
                        var extra = message.content.user;
                        // var extra = message.content.extra;
                        if(status == 1){
                            var str = '<img src="'+message.content.imageUri+'">';
                            $('.live-chate').append(str);
                            $(".live-chate").scrollTop($(".live-chate")[0].scrollHeight);
                        }else{
                            var str = '<div class="padding_10 mg_top10"><div class="clearfix text-center"><dl class="clearfix left width_100"><dt class="right"><img class="head" src="'+extra.portrait+'"></dt><dd class="right padding_lr10"><p class="text_right"><strong>'+extra.name+'</strong></p><p class="mg_top5"><img style="max-width: 200px" src="'+message.content.imageUri+'"></p></dd></dl></div></div>';
                            $('.msg-chat').append(str);
                            $(".msg-chat").scrollTop($(".msg-chat")[0].scrollHeight);
                        }
					}

                    // getMessage(message);
                    //message 为发送的消息对象并且包含服务器返回的消息唯一Id和发送消息时间戳
                    // //console.log("Send successfully");
                },
                onError: function (errorCode, message) {
                    var info = '';
                    switch (errorCode) {
                        case RongIMLib.ErrorCode.TIMEOUT:
                            info = '超时';
                            break;
                        case RongIMLib.ErrorCode.UNKNOWN_ERROR:
                            info = '未知错误';
                            break;
                        case RongIMLib.ErrorCode.REJECTED_BY_BLACKLIST:
                            info = '在黑名单中，无法向对方发送消息';
                            break;
                        case RongIMLib.ErrorCode.NOT_IN_DISCUSSION:
                            info = '不在讨论组中';
                            break;
                        case RongIMLib.ErrorCode.NOT_IN_GROUP:
                            info = '不在群组中';
                            break;
                        case RongIMLib.ErrorCode.NOT_IN_CHATROOM:
                            info = '不在聊天室中';
                            break;
                        default:
                            info = "x";
                            break;
                    }
                    //console.log('发送失败:' + info);
                }
            });
        }
        // function getMessage() {
        RongIMClient.setOnReceiveMessageListener({
            // 接收到的消息
            onReceived: function(message) {

                // 判断消息类型
                console.log('messageContent:');

                console.log(message);

                switch (message.messageType) {
                    case RongIMClient.MessageType.TextMessage:
                        // //console.log(message.content.content)
						// //console.log('yyyy');
                        var extra = eval('(' + message.content.extra + ')');
                        // var extra = message.content.extra;
						if(status == 1){
						    var str = '<p class="live-msg mg_top10"><span class="blue">'+extra.nick_name+':</span>'+message.content.content+' </p>';
						    $('.live-chate').append(str);
                            $(".live-chate").scrollTop($(".live-chate")[0].scrollHeight);
                        }else{

                            if(extra == undefined){
								extra = new Object();

						        extra.nick_name = message.content.user.name;
						        extra.header_img = message.content.user.portrait;
                            }
                            var str = '<div class="padding_10 mg_top10"><div class="clearfix"><dl class="clearfix left"><dt class="left"><img class="head" src="'+extra.header_img+'"></dt><dd class="left padding_lr10"><p><strong>'+extra.nick_name+'</strong></p><p class="mg_top5">'+message.content.content+'</p></dd></dl></div></div>';
                            //发送的消息内容将会被打印
                            $('.msg-chat').append(str);
                            $(".msg-chat").scrollTop($(".msg-chat")[0].scrollHeight);
                        }

                        // answers(message.content.content,message.senderUserId);
                        break;
                    case RongIMClient.MessageType.ImageMessage:
                        var extra = message.content.user;
                        // var extra = message.content.extra;
                        if(status == 1){
                            var str = '<img src="'+message.content.imageUri+'">';
                            $('.live-chate').append(str);
                            $(".live-chate").scrollTop($(".live-chate")[0].scrollHeight);
                        }else{
                            var str = '<div class="padding_10 mg_top10"><div class="clearfix"><dl class="clearfix left"><dt class="left"><img class="head" src="'+extra.portrait+'"></dt><dd class="left padding_lr10"><p><strong>'+extra.name+'</strong></p><p class="mg_top5"><img style="max-width: 200px" src="'+message.content.imageUri+'"></p></dd></dl></div></div>';
                            $('.msg-chat').append(str);
                            $(".msg-chat").scrollTop($(".msg-chat")[0].scrollHeight);
                        }
                        // do something...
                        break;
                    case RongIMClient.MessageType.DiscussionNotificationMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.LocationMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.RichContentMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.DiscussionNotificationMessage:

                        // do something...
                        break;
                    case RongIMClient.MessageType.InformationNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.ContactNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.ProfileNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.CommandNotificationMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.CommandMessage:
                        // do something...
                        break;
                    case RongIMClient.MessageType.UnknownMessage:
                        var str = '';
                        if(status == 1){
                            if(message. senderUserId== 'system'){
                                if(message.content.message.content.content.type == 'gift' ){
                                    if ((gift_status != 1)) return false;
                                    var st = '';
									for(var i=0;i<message.content.message.content.content.data.num.length;i++){
									    st += '<img src="__IMG2__/'+message.content.message.content.content.data.num[i]+'.png"/>';
									}
                                   str = '<p class="padding_10"><img class="bg_gife" style="width: 36px;" src="'+message.content.message.content.content.data.img+'"/><img  src="__IMG2__/x.png"/>'+st+'</p>';
                                    $(".gife").html(str);
                                    $(".gife").css('display','block');
                                    $('.gife').addClass('animated slideInRight');
                                    setTimeout(function(){
                                        $('.gife').removeClass('slideInRight');

                                    }, 1000);
                                    $('.gife').delay(1000).fadeOut(200);
                                    return false;
                                }else if(message.content.message.content.content.type == 'red_package'){
                                    if ((system_status != 1)) return false;
									str = '<p class="live-msg mg_top10"><i class="xi">系</i>'+message.content.message.content.content.data.role_name+'发出了一个红包 <img class="vertical-align_m" id="red" src="__IMG2__/msg_redbag.png" alt=""  onclick="getredPackage(this)" data-id="'+message.content.message.content.content.data.red_id+'" data-name="'+message.content.message.content.content.data.role_name+'" data-type="'+message.content.message.content.content.data.red_type+'" data-img="'+message.content.message.content.content.data.header_img+'"/></p>';
                                }else if(message.content.message.content.content.type == 'guess'){
                                    if ((system_status != 1)) return false;
                                    str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="green">房主发起了一次竞猜</span><img class="vertical-align_m" src="__IMG2__/msg_tv.png" alt="" /></p>';
                                }else if(message.content.message.content.content.type == 'system'){
                                    if ((system_status != 1)) return false;
                                    str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="green">'+message.content.message.content.content.data+'</span><img class="vertical-align_m" src="__IMG2__/msg_tv.png" alt="" /></p>';

                                }else if(message.content.message.content.content.type == 'close'){
                                    if(is_owner != 1) {
                                        layer.msg('主播已关闭直播,2s后将跳转至聊天室,是否立刻跳转?', {
                                            time: 0 //不自动关闭
                                            , btn: ['确定']
                                            , yes: function (index) {
                                                // layer.close(index);
                                                history.go(0);
                                            }
                                        });
                                        setTimeout(function () {
                                            history.go(0);
                                        }, 2000);
                                    }else{
                                        history.go(0);
									}
                                }else if(message.content.message.content.content.type == 'ban'){
                                    if(is_owner != 1 && is_admin != 1){
                                        $(".s_txt").attr("readonly","readonly");
                                        $(".s_txt").attr("placeholder","禁言中");
                                        $(".s_txt").remove("id");
                                        $(".play_msg").attr("readonly","readonly");
                                        $(".play_msg").attr("placeholder","禁言中");
                                        $(".play_msg").remove("id");
                                        $(".send_btn").remove("id");
                                        $(".send_btn1").remove("id");
									}
								}else if(message.content.message.content.content.type == 'remove'){
									if(is_owner != 1 && is_admin != 1){
                                        $(".s_txt").removeAttr("readonly");
                                        $(".s_txt").attr("placeholder","");
                                        $(".s_txt").attr("id",'dm_msg');
                                        $(".play_msg").attr("readonly","none");
                                        $(".play_msg").attr("placeholder","");
                                        $(".play_msg").attr("id",'msg');
                                        $(".send_btn").attr("id",'send');
                                        $(".send_btn1").attr("id",'dm_send');
                                    }
								}

                                if(str != ''){
                                    $(".live-chate").append(str);
                                    $(".live-chate").scrollTop($(".live-chate")[0].scrollHeight);
                                }
                            }
                        }else {
                            if (message.senderUserId == 'system') {
                                if (message.content.message.content.content.type == 'gift') {
                                    str = '<div class="gife"><p class="padding_10"><img class="bg_gife" src="' + message.content.message.content.content.data.img + '"/><img  src="__IMG2__/x.png"/><img src="__IMG2__/2.png"/></p></div>'
                                } else if (message.content.message.content.content.type == 'red_package') {
                                    if(message.content.message.content.content.data.role_id == '{$info.role_id}'){
                                       str = '<div class="padding_10 mg_top10"><div class="clearfix text-center"><dl class="clearfix left width_100"><dt class="right"><img class="head" src="'+message.content.message.content.content.data.header_img+'"></dt><dd class="right padding_lr10"><div class="red-bag" onclick="getredPackage(this)" data-id="'+message.content.message.content.content.data.red_id+'" data-name="'+message.content.message.content.content.data.role_name+'" data-type="'+message.content.message.content.content.data.red_type+'" data-img="'+message.content.message.content.content.data.header_img+'" style="width: 200px;height: 70px;background: url(__IMG2__/redpackage-right.png)no-repeat;background-size:100% 100% ;position: relative;"><p class="color_ff redfont" style="margin: 0px 0 0 45px;padding-top: 10px;width: 150px;text-align: left;">'+message.content.message.content.content.data.msg+'</p><p class="color_ff redfont" style="margin: 0px 0 0 45px;font-size: 0.5rem;width: 150px;text-align: left;">查看红包</p><p class="redtext" style="position: absolute;bottom: 0px;left: 5px;font-size: 12px;color: #a9a9a9;">聊天室红包</p></div></dd></dl></div></div>';
                                    }else{
                                        str = '<div class="padding_10 mg_top10"><div class="clearfix text-center"><dl class="clearfix left width_100"><dt class="left"><img class="head" src="'+message.content.message.content.content.data.header_img+'"></dt><dd class="left padding_lr10"><div class="red-bag left_redbag"  onclick="getredPackage(this)" data-id="'+message.content.message.content.content.data.red_id+'" data-name="'+message.content.message.content.content.data.role_name+'" data-type="'+message.content.message.content.content.data.red_type+'" data-img="'+message.content.message.content.content.data.header_img+'" style="width: 200px;height: 70px;background: url(__IMG2__/redpackage-left.png)no-repeat;position: relative;background-size:100% 100% ;"><p class="color_ff redfont" style="margin: 0px 0 0 45px;padding-top: 10px;width: 150px;text-align: left;">'+message.content.message.content.content.data.msg+'</p><p class="color_ff redfont" style="margin: 0px 0 0 45px;font-size: 0.5rem;width: 150px;text-align: left;">查看红包</p><p class="redtext" style="position: absolute;bottom: 0px;left: 5px;font-size: 12px;color: #a9a9a9;">聊天室红包</p></div></dd></dl></div></div>';
									}
                                } else if (message.content.message.content.content.type == 'guess') {
                                    str = '<p class="live-msg mg_top10"><i class="xi">系</i>' + message.content.message.content.content.data.role_name + '发出了一个红包 <img class="vertical-align_m" id="red" src="__IMG2__/msg_redbag.png" alt="" /></p>';
                                } else if (message.content.message.content.content.type == 'system') {
                                    str = '<p><span>' + message.senderUserId + '：</span>' + message.content.content + '</p>';
                                } else if(message.content.message.content.content.type == 'play'){
                                    if(is_owner != 1){
                                    layer.msg('主播已开启直播,2s后将跳转至直播间,是否立刻跳转?', {
                                        time: 0 //不自动关闭
                                        ,btn: ['确定']
                                        ,yes: function(index){
                                            // layer.close(index);
                                            history.go(0);
                                        }
                                    });
                                    setTimeout(function () {
                                        history.go(0);
                                    },2000);
                                    }else{
                                        history.go(0);
									}
                                }else if(message.content.message.content.content.type == 'ban'){
                                    if(is_owner != 1 && is_admin != 1){
                                        $(".chat_msg").attr("readonly","readonly");
                                        $(".chat_msg").attr("placeholder","禁言中");
                                        $(".chat_msg").remove("id");
                                        $(".send_btn").remove("id");
                                    }

                                }else if(message.content.message.content.content.type == 'remove'){
                                    if(is_owner != 1 && is_admin != 1){
                                        $(".chat_msg").removeAttr("readonly");
                                        $(".chat_msg").attr("placeholder","");
                                        $(".chat_msg").attr("id",'msg');
                                        $(".send_btn").attr("id",'send');
                                    }
                                }
                                if(str.length !=0){
                                    $(".msg-chat").append(str);
                                    $(".msg-chat").scrollTop($(".msg-chat")[0].scrollHeight);
                                }

                            }
                        }

                        //console.log('xxxxx');
                        // do something...
                        break;
                    case RongIMClient.MessageType.VoiceMessage:
                        // //console.log(message);
                        // getVoice((message.content.duration), (message.content.content));

                        break;
                    case RongIMClient.MessageType.PersonMessage:
                        // //console.log(message);
                        // getVoice((message.content.duration), (message.content.content));
                        var extra = eval('(' + message.content.extra + ')');
                        // var extra = message.content.extra;

                        var str = '<p class="live-msg mg_top10"><i class="xi">系</i><span class="blue">'+extra.nick_name+'</span> 进入直播间<img class="vertical-align_m" src="__IMG2__/msg_hores.png" alt="" /></p>';
                        $('.live-chate').append(str);
                        $(".live-chate").scrollTop($(".live-chate")[0].scrollHeight);

                        break;
                    default:
                        //console.log(message);

                    // 自定义消息
                    // do something...
                }
            }
        });
        //去除标签
        function escapeJquery(srcString) {
            var escapseResult = srcString;

            var reg = new RegExp("<[^<]*>", "gi");
			escapseResult = escapseResult.replace(reg, "");
        	// console.log(escapseResult)
            return escapseResult;
        };

        $("#send").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                if(escapeJquery($("#msg").val()) == ''){
                    $("#msg").val('');
                    return false;
                }
				var str = $("#msg").val().substr(0,40);
                var extra = new Object();
                extra.role_id = "{$info.role_id}";
                extra.nick_name = "{$info.role_name}";
                extra.header_img = "{$info.header_img}";
                var msg = new RongIMLib.TextMessage({
                    content: escapeJquery(str),
                    extra:JSON.stringify(extra),
                });
                $("#msg").val('');
                sendMessage(msg);
            }

        });
		function strlen(str) {
            ///<summary>获得字符串实际长度，中文2，英文1</summary>
            ///<param name="str">要获得长度的字符串</param>
            var realLength = 0, len = str.length, charCode = -1;
            for (var i = 0; i < len; i++) {
                charCode = str.charCodeAt(i);
                if (charCode >= 0 && charCode <= 128)
                    realLength += 1;
                else
                    realLength += 2;
            }
            return realLength;
        };
        $("#dm_send").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                if(escapeJquery($("#dm_msg").val()) == ''){
                    $("#dm_msg").val('');
                    return false;
                }
                var str = $("#dm_msg").val().substr(0,40);
                var extra = new Object();
                extra.role_id = "{$info.role_id}";
                extra.nick_name = "{$info.role_name}";
                extra.header_img = "{$info.header_img}";
                var msg = new RongIMLib.TextMessage({
                    content: escapeJquery(str),
                    extra:JSON.stringify(extra),
                });
                $("#dm_msg").val('');
                sendMessage(msg);
            }

        });
		// $("#msg").focus(function () {
        $('#dm_msg').bind('keyup', function(event) {
            if (event.keyCode == "13") {
                //回车执行查询
                if(no_login_status == 1){
                    location.href = '{:url("login/login")}';
                }else{
                    $('#dm_send').click();
                }
            }
        });
        $('#msg').bind('keyup', function(event) {
            if (event.keyCode == "13") {
                //回车执行查询
                if(no_login_status == 1){
                    location.href = '{:url("login/login")}';
                }else{
                    $('#send').click();
                }
            }
        });
		// $("#md_msg").focus(function () {

            //   });
        $(" .redbag-box").on('click',".redbab-btn" ,function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var form = new FormData($("#redpackge")[0]);

                if(isNaN(form.get('num'))){
                    layer.msg('红包个数不为数字，请重新输入', {icon: 5, time: 2000});
                    return false;
                }
                if(form.get('red_type') == 2){
                    if(form.get('num')< 2){
                        layer.msg('拼手气红包数量应该大于二', {icon: 5, time: 2000});
                        return false;
                    }
                }
                if(isNaN(form.get('money'))){
                    layer.msg('红包总金额不为数字，请重新输入', {icon: 5, time: 2000});
                    return false;
                }
                if(status == 1){
                    form.append('type',3)
                }else{
                    form.append('type',2)
                }
                form.append('to_id','{$room_info.room_id}');
                //console.log(form);
                httpPosts('/red_package/sendred',form);

                code();
                // //console.log(result);
                $("#red_reset").click();
                $("#red").parents('.redbag-box').fadeOut(200);
                var a = $("#red").parents('.redbag-box').is(":hidden")
                if(a==false){
                    $(".redbag-box").hide()
                }
                // //console.log(a )
                // //console.log(111)
                $('.overlay').hide();
            }
        });
		function getredPackage(that) {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var id = $(that).data('id');
                var name = $(that).data('name');
                var img = $(that).data('img');
                var type = $(that).data('type');
                var form = new FormData();
                form.append('to_id',"{$room_info.room_id}")
                form.append('red_id',id)
                form.append('red_type',type);
                var result = httpPost_red('/red_package/redstatus',form);
                $("#header_img").attr('src',img);
                $("#name").html(name);
                $("#red_id").val(id);
                $("#red_type").val(type);
                if(result == 1){
                    $('.envelope').fadeIn(200)
                    $('.overlay').show();
                }else{
                    var forms = new FormData();
                    forms.append('red_id',id);
                    var res = httpPosts('/red_package/reddetails',forms);
                    // //console.log(res);
                    var str = '';
                    str += '<div class="padding_tb20 text-center"><img class="head-home" src="'+res.top.header_img+'"/><p><strong>'+res.top.role_name+'的红包</strong></p><h6 class="mg_top5">'+res.top.msg+'</h6><h3 class="red font_18 mg_top5">'+res.top.money+'</h3></div><p class="padding_10 bg_e">'+res.top.status+'</p>';
                    for(var i=0;i<res.data.length;i++){
                        str += '<dl class="clearfix padding_10 bor_b"><dt class="left"><img class="head" src="'+res.data[i]["header_img"]+'"/></dt><dd class="left head-dd"><div class="clearfix"><div class="left"><p>'+res.data[i]["role_name"]+'</p><h6>'+res.data[i]["create_time"]+'</h6></div><strong class="right mg_top10">'+res.data[i]["money"]+'</strong></div></dd></dl>';
                    }
                    $("#red_detail").html(str);
                    $('.redpackage_detail').fadeIn(200)
                    $('.overlay').show();
                }
            }
        }
        $("#chai").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var form = new FormData();
                form.append('to_id',"{$room_info.room_id}")
                form.append('red_id',$("#red_id").val())
                form.append('red_type',$("#red_type").val());
                var result = httpPost_red('/red_package/receivered',form);

                var forms = new FormData();
                var id = $("#red_id").val();
                forms.append('red_id',id);
                var res = httpPosts('/red_package/reddetails',forms);
                //console.log(res);
                code();
                var str = '';
                str += '<div class="padding_tb20 text-center"><img class="head-home" src="'+res.top.header_img+'"/><p><strong>'+res.top.role_name+'的红包</strong></p><h6 class="mg_top5">'+res.top.msg+'</h6><h3 class="red font_18 mg_top5">'+res.top.money+'</h3></div><p class="padding_10 bg_e">'+res.top.status+'</p>';
                for(var i=0;i<res.data.length;i++){
                    str += '<dl class="clearfix padding_10 bor_b"><dt class="left"><img class="head" src="'+res.data[i]["header_img"]+'"/></dt><dd class="left head-dd"><div class="clearfix"><div class="left"><p>'+res.data[i]["role_name"]+'</p><h6>'+res.data[i]["create_time"]+'</h6></div><strong class="right mg_top10">'+res.data[i]["money"]+'</strong></div></dd></dl>';
                }
                $("#red_detail").html(str);
                $("#chai").parent().parent().fadeOut(200)
                $('.redpackage_detail').fadeIn(200)
                $('.overlay').show();
            }
        });
		$('.send_gift').click(function () {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var form = new FormData();
                var num = $(this).parent().siblings('input').val();
                var gift_id = $(this).data('id');
                form.append('room_id','{$room_info.room_id}');
                form.append('gift_id',gift_id);
                form.append('num',num);
                httpPosts('/gift/giveGift',form);
                code();
            }
        });

		function check(that) {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var id = $(that).data('id');
                if($(that).hasClass('active')){
                    $(that).removeClass('active');
                    if(id == 1){
                        gift_status = 1;
                    }else{
                        system_status = 1;
                    }
                }else{
                    $(that).addClass('active');
                    if(id == 1){
                        gift_status = 0;
                    }else{
                        system_status = 0;
                    }
                }
            }
        }
        function code() {
            var money = httpPosts('/user/getMoney');
			$('#code').html('当前积分：'+money.money);
			$('#now_code').html('当前积分：'+money.money);
        }
        $("#follow").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var follow = $(this).html();
                var num = $("#fans_num").html();
                if(follow == '关注'){
                    var formDatas = new FormData();
                    formDatas.append('room_id','{$room_info.room_id}');
                    var result = httpPosts('/Focus/addFocusRoom',formDatas);
                    // //console.log(result);
                    if(result == null){
                        $('#follow').css('background','#d9d9d9');
                        $('#follow').css('color','#7f7f7f');
                        $('#follow').css('border','#d9d9d9  1px solid');
                        $('#follow').html('已关注');
                        num++;
                        $('#fans_num').html(num);
                    }
                }else{
                    var formDatas = new FormData();
                    formDatas.append('room_id','{$room_info.room_id}');
                    var result = httpPosts('/Focus/hiddenRoom',formDatas);
                    // //console.log(result);
                    if(result == null){
                        $('#follow').css('background','#2e89fe');
                        $('#follow').css('color','#fff');
                        $('#follow').html('关注');
                        num--;
                        $('#fans_num').html(num);
                    }
                }
            }
        })
        $('.report').click(function(){
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                $('.report_box').fadeIn(200)
                $('.overlay').show()
            }
        })
		$("#report_submit").click(function () {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var result = '';
                var img = $('#file')[0].files;
                // //console.log(img)
                var form = new FormData($('#report')[0]);
                var formData = new FormData();
                if(form.get('reason') == ''){
                    layer.msg('举报原因不能为空', {icon: 5, time: 1000});
                    return false;
                }
                if(form.get('detail') == ''){
                    layer.msg('举报理由不能为空', {icon: 5, time: 1000});
                    return false;
                }
                if(img.length ==0){
                    layer.msg('举报图片不能为空', {icon: 5, time: 1000});
                    return false;
                }else if(img.length >3){
                    layer.msg('举报图片超过限制', {icon: 5, time: 1000});
                    return false;
                }
                for(var i=0;i<img.length;i++){
                    var forms = new FormData();
                    forms.append('file',img[i]);
                    var res =  httpPosts('/upload/index',forms);
                    result += res+ ',';
                }
                result = result.substr(0,result.length-1);
                formData.append('reason',form.get('reason'))
                formData.append('detail',form.get('detail'))
                formData.append('imgs',result)
                formData.append('id','{$room_info.room_id}')
                formData.append('type',1);
                var data = httpPosts('/gift/report',formData);
                if(data == null) {
                    $(".report_box").fadeOut(200)
                    $('.overlay').hide()
                    layer.msg('举报成功', {icon: 1, time: 1000});
                }
            }
        });
		$("#guess_begin").click(function () {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var form = new FormData($("#guess")[0]);
                var title = form.get('title');
                var answer_A = form.get('answer_A');
                var answer_B = form.get('answer_B');
                title = escapeJquery(title);
                answer_A = escapeJquery(answer_A);
                answer_B = escapeJquery(answer_B);
                if( title == ''){
                    layer.msg('竞猜标题不能为空',{icon:5,time:1000});
                    return false;
                }
                if(answer_A == '' || answer_B == ''){
                    layer.msg('竞猜答案不能为空',{icon:5,time:1000});
                    return false;
                }
                var forms = new FormData();
                forms.append('room_id','{$room_info.room_id}');
                forms.append('title',title);
                forms.append('answer_A',answer_A);
                forms.append('answer_B',answer_B);
                $('#guess_reset').click();
                var data = httpPosts('/guess/addGuess',forms);
                if(data == null){
                    $(".quiz-box").fadeOut(200)
                    $('.overlay').hide()
                    layer.msg('竞猜发起成功', {icon: 1, time: 1000});
                }
            }
        });
        $(".in_quiz-a").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var sta = '';
                if($(this).data('status') == 0){
                    var form = new FormData();
                    form.append('room_id','{$room_info.room_id}');
                    var  guess = httpPosts('/guess/getGuess',form);
                    // //console.log(guess);
                    var str = '';
                    var type = 0;
                    for(var i=0;i<guess.length;i++){
                        if(guess[i]['status'] == 1){
                            type = 1;
                            sta = '封盘';
                        }else if(guess[i]['status'] == 2){
                            type = 2;
                            sta = '结束';
                        }else{
                            type = 3;
                            sta = '已结算';
                        }
                        if('{$room_info.is_Homeowner}' == '0'){
                            sta = '开猜';
                            type = 0;
                        }
                        var string = '<div class="quiz mg_top10"><div class="quiz_list"><p class="quiz_list_tittle clearfix bor_b padding_10"><span class="left"> <i class="cicly">'+(i+1)+'</i>'+guess[i]["title"]+'</span><a href="javascript:;" class="right blue" onclick="guess(this)" data-id="'+guess[i]["guess_id"]+'"  data-status="'+type+'">'+sta+'</a></p><div class="bor_b padding_10"><p class="clearfix  padding_10 "><span class="left">'+guess[i]["answer_A"]+'</span><span class="right">'+guess[i]["answer_B"]+'</span></p><div class="clearfix mg_top5"><div class="left"><p class="clearfix bor_b padding_lr10  quiz_line quiz_left"><span class="left">'+guess[i]["a_money"]+' 人数:'+guess[i]["a_num"]+'</span></p></div><p class="left pk_img text-center"><img src="__IMG2__/vs.png" alt=""></p><div class="right"><p class="clearfix bor_b padding_lr10  quiz_right quiz_line"><span class="right">'+guess[i]["b_money"]+' 人数:'+guess[i]["b_num"]+'</span></p></div></div></div></div></div>'
                        str += string;
                    }
                    $('.pk-box1').html(str);
                    $('.pk-box').css('transform','translateY(0)')
                    $('.pk-box').css('opacity','1')
                    // $('.pk-box').css('z-index','1')
                    $('.pk-box').css('transition','all 0.5s ease-in-out');
                    $(this).data('status',1);
                }else{
                    $('.pk-box').css('transform','translateY(214px)')
                    $('.pk-box').css('opacity','0')
                    // $('.pk-box').css('z-index','-999')
                    $('.pk-box').css('transition','all 0.5s ease-in-out');
                    $(this).data('status',0);
                }
            }
        });
		$("#close").click(function () {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                $('.pk-box').css('transform','translateY(214px)')
                $('.pk-box').css('opacity','0')
                // $('.pk-box').css('z-index','-999')
                $('.pk-box').css('transition','all 0.5s ease-in-out');
            }
        });
		function guess(that) {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var guess_id = $(that).data('id');
                var type = $(that).data('status');
                $("#answer_id").val(guess_id);
                $("#answer_type").val(type);
                var form = new FormData();
                form.append('guess_id',guess_id);
                var result = httpPosts('/guess/detailsGuess',form);
                // //console.log(result);
                if(type == 1){
                    httpPosts('/guess/endGuess',form)
                    layer.msg('封盘成功',{icon:1,time:1000});
                    $("#answer_type").val(2);
                    $(that).data('status',2);
                    $(that).html('结束');
                    return false;
                }else if(type == 2){
                    $("#money").parent().css('display','none');
                    $("#guess_submit").html('结束');
                }else if(type == 0){
                    $("#guess_submit").html("开猜");
                }else{
                    $("#guess_submit").html("GG");
                }
                $("#title").children('span').html(result.title)
                $("#answer_a").html(result.answer_A);
                $("#answer_b").html(result.answer_B);
                $('.chicken-box').fadeIn(200)
                $('.overlay').show();
            }
        }
        $("#io").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var form = new FormData();
                form.append('id','{$room_info.room_id}')
                form.append('is_mobile',0);
                if(status == 0){
                    httpPosts('/play/activity',form);
                }else{
                    httpPosts('/play/actEnd',form);
                }
            }
        })
        $("#guess_submit").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                var guess_id = $("#answer_id").val();
                var guess_type = $("#answer_type").val();
                var right = $("#right").val();
                if(right == ''){
                    layer.msg('请选择一方进行投注',{icon:5,time:1000});
                    return false;
                }
                var money = $("#money").val();
                if(guess_type == 0 && money == ''){
                    layer.msg('请输入投注金额',{icon:5,time:1000});
                    return false;
                }
                var url = '';
                var form = new FormData();
                form.append('guess_id',guess_id);
                if(guess_type == 2){
                    url = '/guess/resultGuess';
                    form.append('right',right);
                }else if(guess_type == 0){
                    url = '/guess/addRecord';
                    form.append('answer',right);
                    form.append('money',money);
                }
                var result = httpPosts(url,form);
                if(result == null){
                    $('#answer_b').removeClass('bg_blue');
                    $('#answer_a').removeClass('bg_blue');
                    $("#money").val('');
                    $(".chicken-box").fadeOut(200)
                    $('.overlay').hide();
                    $("#close").click();
                }
            }
        });
        $("#answer_a").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                $(this).addClass('bg_blue');
                $('#answer_b').removeClass('bg_blue');
                $("#right").val('A');
            }
        })
        $("#answer_b").click(function () {
            if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                $(this).addClass('bg_blue');
                $('#answer_a').removeClass('bg_blue');
                $("#right").val('B');
            }
        })
		$(".pic-a").click(function () {
		    if(no_login_status == 1){
                location.href = '{:url("login/login")}';
            }else{
                $("#file_pic").click();
            }
		})
		$("#file_pic").change(function () {
            var files = $('#file_pic')[0].files[0];
            if (!files){
                layer.msg('您未选择文件', {icon: 5, time: 2000});return false;
            }
            var formData = new FormData();
            var result = httpPosts('/upload/token',formData);
            var token = result.token;
            var index = files.name.lastIndexOf(".");
            var ext = files.name.substring(index);
            var key = takeName('pic',2)+ext;
            var config = {
                useCdnDomain: true,
                region: qiniu.region.z0,
                concurrentRequestLimit:3,
            };
            var putExtra = {
                fname: files.name,
                params: {},
                mimeType:  null
            };
            var observer = {
                next(res){

                },
                error(err){
                    layer.msg('上传失败,请稍后重试'+err.message, {icon: 5, time: 2000});
                    layer.closeAll("loading");
                },
                complete(res){
                    var domain = result.url;
                    var url = domain+'/'+res.key;
                    var extra = new Object();
                    extra.id = "{$info.role_id}";
                    extra.name = "{$info.role_name}";
                    extra.portrait = "{$info.header_img}";
                    var image = new Image();
                    image.crossOrigin = '';
                    image.src = url;
                    var base = '';
                    image.onload = function(){
                      	base = getBase64Image(image);
                        var msg = new RongIMLib.ImageMessage({
                            content: base,
                            imageUri: url,
                            user:extra,
                        });
                        sendMessage(msg);
                        $("#file_pic").val('');
                    }
                }
            };
            var observable = qiniu.upload(files, key, token, putExtra, config)
            var subscription = observable.subscribe(observer)
        });
        function getBase64Image(img) {
            var canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, img.width, img.height);
            var ext = img.src.substring(img.src.lastIndexOf(".")+1).toLowerCase();
            var dataURL = canvas.toDataURL("image/"+ext);
            return dataURL.replace("data:image/png;base64,", "");
        }
	</script>

	</body>
</html>
