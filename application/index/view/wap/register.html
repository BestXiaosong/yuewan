<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>soha</title>


    <link rel="stylesheet" href="__CSS__/css.css"/>
    <!--公用js-->
    {include file="public/js" /}
    <style>
        .flow-box{
            width: 90%;
            height: 300px;
            position: fixed;
            top: 50%;
            left: 5%;
            top: 50%;
            margin-top: -150px;
            background: #fff;
            z-index: 30;
            display: none;
        }
        .overlay{
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,.5);
            z-index: 10;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }
        .basic_spring h4 {
            border-radius: 5px 5px 0 0;
        }
        .live_springmain input {
            /*width: 80%;*/
            border: 1px solid #DADADA;
            border-radius: 5px;
            padding: 5px;
            height: 30px;
        }
        #copy{
            color: #3683F3;
        }
    </style>

</head>
<body>
    <div class="login">
        <img src="__IMG__/logo.png" alt=""/>
        <form action="{$API}/login/login.html" id="form">
        <ul>

                <li>
                    <input name="phone" placeholder="请输入账号" type="text"/>
                </li>
            <li>
                <input name="code" type="text"/>
                <a  class="getcode" id="msg">获取验证码</a>
                <a  class="getcode" id="num">0</a>
            </li>
                <li>
                    <input style="background-image:url('__IMG__/mima.png')"  name="password" placeholder="请输入密码" type="password"/>
                </li>
            <li>
                <input style="background-image:url('__IMG__/mima.png')"  name="password" placeholder="请输入交易密码" type="password"/>
            </li>
            <input type="hidden" id="id" {if isset($id)} value="{$id}"{/if}>
        </ul>
        <!--<div id="slider">-->
            <!--<div id="slider_bg"></div>-->
            <!--<span id="label">&gt;&gt;</span> <span id="labelTip">拖动滑块验证</span>-->
            <!--<input type="hidden" id="code" value="0"/>-->
        <!--</div>-->
        <a  class="sub on">注册</a>


        </form>


        <!--<p class="res-box">-->
            <!--&lt;!&ndash;<a href="login.html">立即登录</a>&ndash;&gt;-->
            <!--<a href="{:url('wap/edit')}" class="res">忘记密码？</a>-->
        <!--</p>-->
        <!--<img src="__IMG__/loz.png" alt="" class="loz"/>-->
        <!--<p class="san">-->
            <!--<a href="">-->
                <!--<img src="__IMG__/max-wx.png" alt=""/>-->
            <!--</a>-->
            <!--<a href="">-->
                <!--<img src="__IMG__/max-qq.png" alt=""/>-->
            <!--</a>-->
           <!--{/** <a href="login-mg.html">-->
                <!--<img src="__IMG__/max-mg.png" alt=""/>-->
            <!--</a>-->
            <!--*/}-->
            <!--<a href="{:url('phone')}">-->
                <!--<img src="__IMG__/max-sj.png" alt=""/>-->
            <!--</a>-->
        <!--</p>-->
        <p class="lo-txt" style="clear: both">
            注册即代表同意SOHA直播平台服务协议
        </p>
    </div>
    <div class="basic_spring flow-box" >
        <h4 class="clearfix text-center bg_e padding_tb10 color_55">注册成功
            <a href="javascript:;" class="right padding_lr10 dell_a"><img src="__IMG2__/icon-dell.png"></a>
        </h4>
        <div class="bg_ff live_springmain">

            <p class="mg_top20 clearfix padding_10">
                <span class="left" id="public">公钥：</span>
            </p>
            <p class="mg_top20 clearfix padding_10">
                <span class="left" id="private">私钥：<input type="text"  id="hidden_private" readonly="readonly"></span>
                <!--<input id="foo" type="text" value="hello111">-->
                <!--<button class="btn" data-clipboard-action="copy" data-clipboard-target="#foo">Copy</button> <br><br>-->
                <a class="right mg_top10" id="copy" data-clipboard-action="copy" data-clipboard-target="#hidden_private" >复制</a>
            </p>
            <!--<p class="mg_top20 clearfix padding_10">-->

                <!--<span class="left" id="download">app下载地址:<a href="{:url('download')}">{:url('download')}</a></span>-->
            <!--</p>-->
            <p class="mg_top40 text-center"><a href="javascript:;" class="btn-a " id="sure">确定</a></p>
        </div>

    </div>
    <div class="overlay"></div>
    <script src="__JS__/jquery.slideunlock.js"></script>
    <script src="__JS__/index.js" type="text/javascript" charset="utf-8"></script>
    <!--<script src="__JS__/hd.js" type="text/javascript" charset="utf-8"></script>-->
    <script src="__JS__/clipboard.js" type="text/javascript" charset="utf-8"></script>
    <script>
        $(function () {
            var clipboard = new Clipboard('#copy');

        })
        var countdown=60;
        var _generate_code = $(".generate_code");
        function settime() {
            if (countdown == 0) {
                _generate_code.attr("disabled",false);
                _generate_code.val("获取验证码");
                countdown = 60;
                return false;
            } else {
                $(".generate_code").attr("disabled", true);
                _generate_code.val("重新发送(" + countdown + ")");
                countdown--;
            }
            setTimeout(function() {
                settime();
            },1000);
        }
        $(function(){


        })
        $("#login").css('height',$(document).height())
        var phone = '';
        var code  = '';
        var set;

        //获取验证码
        $('#msg').click(function(){

            var phone = $("input[name='phone']").val();
            if (!phone){
                layer.msg('请输入手机号码');
                return false;
            }else{
                if (!verify.is_phone(phone)){
                    layer.msg('请输入正确的手机号码');
                    return false;
                }
            }
            var formData = new FormData();
            formData.append('phone',phone);
            var btn = $(this);
            var data = httpPost('/index/sms',formData,btn,true);
            if (data !== false){
                layer.msg('发送成功');
                layer.closeAll("loading");
                btn.attr('disabled', false);
                settime();
            }
        })

        //登录
        $('.sub').click(function () {
            var phone = $("input[name='phone']").val();
            if (!phone){
                layer.msg('请输入手机号码');
                return false;
            }else{
                if (!verify.is_phone(phone)){
                    layer.msg('请输入正确的手机号码');
                    return false;
                }
            }
            var code = $("input[name='code']").val();
            if (!code){
                layer.msg('请输入验证码');
                return false;
            }else{
                if (!verify.is_num(code) || code.length != 6){
                    layer.msg('验证码错误');
                    return false;
                }
            }
            var password = $("#password").val();
            var trade_password = $("#trade_password").val();
            var formData = new FormData();
            var openid = $("#openid").val()
            var type = $("#type").val()
            var user_id = $("#id").val()
            if(openid != ''){
                formData.append('openid',openid);
            }
            if(type != ''){
                formData.append('type',type);
            }
            if(user_id != ''){
                formData.append('id',user_id);
            }
            formData.append('password',password)
            formData.append('trade_password',trade_password)
            formData.append('phone',phone);
            formData.append('code',code);

            var btn = $(this);
            var data = httpPost('/login/register',formData,btn,true);
            if (data !== false){
                layer.closeAll('loading');
                $('#public').html('公钥：'+data.public.substr(0,15)+'<br/>'+data.public.substr(15));

                $('#hidden_private').attr('value',data.private_key);
                $('.flow-box').fadeIn(200);
                $('.overlay').show();
            }
        });

        $("#sure").click(function () {
            successRedirect('注册成功', "{:url('download')}", 1);
        })

        $(function () {
            var slider = new SliderUnlock("#slider",{
                successLabelTip : "验证成功"
            },function(){
                $('#code').val(1);
//                alert("验证成功");
//                window.location.href=""
            });
            slider.init();
        })
    </script>
</body>
</html>